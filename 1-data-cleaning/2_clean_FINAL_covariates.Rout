
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Previously saved workspace restored]

> 
> #-----------------------------------------------------------------------------------------
> # Process FINAL dataset into a dataset of covariates to be used in the exposure/risk factor
> # analysis in the causes and consequences manuscript. 
> #
> # Output: Single dataset with one row per child and all baseline covariates
> #         Time-varying covariates and anthropometry measures processed in a seperate script.
> #
> # Author: Andrew Mertens (amertens@berkeley.edu)
> #-----------------------------------------------------------------------------------------
> 
> 
> 
> 
> rm(list=ls())
> source(paste0(here::here(), "/0-config.R"))
── Attaching packages ────────────────────────────────── tidyverse 1.3.0.9000 ──
✔ ggplot2 3.2.1     ✔ purrr   0.3.3
✔ tibble  2.1.3     ✔ dplyr   0.8.3
✔ tidyr   1.0.0     ✔ stringr 1.4.0
✔ readr   1.3.1     ✔ forcats 0.4.0
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
here() starts at /home/andrew.mertens/ki-longitudinal-manuscripts

Attaching package: ‘gridExtra’

The following object is masked from ‘package:dplyr’:

    combine


Attaching package: ‘reshape2’

The following object is masked from ‘package:tidyr’:

    smiths

Loading required package: Matrix

Attaching package: ‘Matrix’

The following objects are masked from ‘package:tidyr’:

    expand, pack, unpack

Loading 'metafor' package (version 2.1-0). For an overview 
and introduction to the package please type: help(metafor).

Attaching package: ‘data.table’

The following objects are masked from ‘package:reshape2’:

    dcast, melt

The following objects are masked from ‘package:dplyr’:

    between, first, last

The following object is masked from ‘package:purrr’:

    transpose

Loading required package: viridisLite

Attaching package: ‘maps’

The following object is masked from ‘package:purrr’:

    map


Attaching package: ‘ggridges’

The following object is masked from ‘package:ggplot2’:

    scale_discrete_manual


Attaching package: ‘assertthat’

The following object is masked from ‘package:tibble’:

    has_name

Loading required package: nlme

Attaching package: ‘nlme’

The following object is masked from ‘package:dplyr’:

    collapse

This is mgcv 1.8-30. For overview type 'help("mgcv-package")'.

Attaching package: ‘lazyeval’

The following objects are masked from ‘package:purrr’:

    is_atomic, is_formula


Attaching package: ‘rlang’

The following objects are masked from ‘package:lazyeval’:

    as_name, call_modify, call_standardise, expr_label, expr_text,
    f_env, f_env<-, f_label, f_lhs, f_lhs<-, f_rhs, f_rhs<-, f_text,
    is_atomic, is_call, is_formula, is_lang, is_pairlist, missing_arg

The following object is masked from ‘package:assertthat’:

    has_name

The following object is masked from ‘package:data.table’:

    :=

The following objects are masked from ‘package:purrr’:

    %@%, as_function, flatten, flatten_chr, flatten_dbl, flatten_int,
    flatten_lgl, flatten_raw, invoke, list_along, modify, prepend,
    splice


Attaching package: ‘scales’

The following object is masked from ‘package:viridis’:

    viridis_pal

The following object is masked from ‘package:purrr’:

    discard

The following object is masked from ‘package:readr’:

    col_factor


Attaching package: ‘foreach’

The following objects are masked from ‘package:purrr’:

    accumulate, when

Loading required package: iterators
Loading required package: parallel
Loading required package: survival

Attaching package: ‘survey’

The following object is masked from ‘package:graphics’:

    dotchart

Loading required package: bit
Attaching package bit
package:bit (c) 2008-2012 Jens Oehlschlaegel (GPL-2)
creators: bit bitwhich
coercion: as.logical as.integer as.bit as.bitwhich which
operator: ! & | xor != ==
querying: print length any all min max range sum summary
bit access: length<- [ [<- [[ [[<-
for more help type ?bit

Attaching package: ‘bit’

The following object is masked from ‘package:data.table’:

    setattr

The following object is masked from ‘package:base’:

    xor

Attaching package bit64
package:bit64 (c) 2011-2012 Jens Oehlschlaegel
creators: integer64 seq :
coercion: as.integer64 as.vector as.logical as.integer as.double as.character as.bin
logical operator: ! & | xor != == < <= >= >
arithmetic operator: + - * / %/% %% ^
math: sign abs sqrt log log2 log10
math: floor ceiling trunc round
querying: is.integer64 is.vector [is.atomic} [length] format print str
values: is.na is.nan is.finite is.infinite
aggregation: any all min max range sum prod
cumulation: diff cummin cummax cumsum cumprod
access: length<- [ [<- [[ [[<-
combine: c rep cbind rbind as.data.frame
WARNING don't use as subscripts
WARNING semantics differ from integer
for more help type ?bit64

Attaching package: ‘bit64’

The following object is masked from ‘package:bit’:

    still.identical

The following objects are masked from ‘package:base’:

    :, %in%, is.double, match, order, rank


Attaching package: ‘zoo’

The following objects are masked from ‘package:base’:

    as.Date, as.Date.numeric

Warning message:
New theme missing the following elements: line, rect, text, axis.title.x, axis.title.x.top, axis.title.y, axis.title.y.right, axis.text, axis.text.x, axis.text.x.top, axis.text.y, axis.text.y.right, axis.ticks, axis.ticks.length, axis.ticks.length.x, axis.ticks.length.x.top, axis.ticks.length.x.bottom, axis.ticks.length.y, axis.ticks.length.y.left, axis.ticks.length.y.right, axis.line, axis.line.x, axis.line.y, legend.background, legend.margin, legend.spacing, legend.spacing.x, legend.spacing.y, legend.key, legend.key.size, legend.key.height, legend.key.width, legend.text, legend.text.align, legend.title, legend.title.align, legend.position, legend.direction, legend.justification, legend.box, legend.box.margin, legend.box.background, legend.box.spacing, panel.background, panel.border, panel.spacing, panel.spacing.x, panel.spacing.y, panel.grid, panel.grid.minor, panel.ontop, plot.background, plot.title, plot.subtitle, plot.caption, plot.tag, plot.tag.position, plot.margin, strip.backgr [... truncated] 
> library(growthstandards)
Registered S3 method overwritten by 'pryr':
  method      from
  print.bytes Rcpp
> 
> 
> d <- readRDS(included_studies_path)
> 
> 
> #--------------------------------------------------------
> # Calculate longitudinal prevalence of wasting and stunting
> # in the first 6 months.
> #--------------------------------------------------------
> 
> lprev <- d %>% group_by(studyid, country, subjid) %>%
+   #only keep it in monthly studies
+   filter(measurefreq=="monthly") %>%
+   filter(agedays<6*30.4167) %>%
+   mutate(wast=as.numeric(whz < -2), stunt=as.numeric(haz < -2)) %>%
+   summarize(N=n(), wastprev06=mean(wast, na.rm=T), stuntprev06=mean(stunt, na.rm=T), anywast06=as.numeric(wastprev06>0), anystunt06=as.numeric(stuntprev06>0), 
+             pers_wast=as.numeric(wastprev06>=0.5)) %>%
+   mutate(pers_wast=ifelse(N>=4,pers_wast,NA))
> head(lprev)
# A tibble: 6 x 9
# Groups:   studyid, country [1]
  studyid country subjid     N wastprev06 stuntprev06 anywast06 anystunt06
  <chr>   <chr>   <int6> <int>      <dbl>       <dbl>     <dbl>      <dbl>
1 CMC-V-… INDIA   1         15        0.4       0.8           1          1
2 CMC-V-… INDIA   2         38        0         0             0          0
3 CMC-V-… INDIA   3         33        0         0             0          0
4 CMC-V-… INDIA   4         53        0.8       0             1          0
5 CMC-V-… INDIA   5         13        0.5       0.833         1          1
6 CMC-V-… INDIA   6         36        0         1             0          1
# … with 1 more variable: pers_wast <dbl>
> 
> table(lprev$anywast06)

   0    1 
7854 2480 
> table(lprev$anystunt06)

   0    1 
6988 3374 
> table(lprev$pers_wast)

   0    1 
9178  455 
> 
> #Merge in new variables
> lprev <- lprev %>% subset(., select = c(studyid, country,subjid, anywast06,  pers_wast))
> 
> dim(d)
[1] 7540678      56
> d <- left_join(d, lprev, by=c("studyid","country","subjid"))
> dim(d)
[1] 7540678      58
> 
> 
> 
> 
> #--------------------------------------------------------
> # Calculate birth month and month from birth week if birthmonth is missing
> #--------------------------------------------------------
> 
> #fill in missing birthmonth
> table(d$brthmon)

     1      2      3      4      5      6      7      8      9     10     11 
434795 666150 710365 568089 516124 437962 518954 521569 510356 419980 433995 
    12 
442825 
> d$brthmon[is.na(d$brthmon)] <- ceiling(d$brthweek[is.na(d$brthmon)]/4.42)
> table(d$brthmon)

     1      2      3      4      5      6      7      8      9     10     11 
439209 670417 715198 571397 519845 441200 521305 525725 514584 424968 437801 
    12 
446635 
> 
> #fill in missing month if brthmonth is present
> table(d$month)

     1      2      3      4      5      6      7      8      9     10     11 
533047 488056 529897 501413 517557 497818 513272 500408 513804 533488 518109 
    12 
534295 
> d$month[is.na(d$month) & !is.na(d$brthmon)] <- floor(d$brthmon[is.na(d$month) & !is.na(d$brthmon)] + d$agedays[is.na(d$month)& !is.na(d$brthmon)]/30.4167) %% 12 +1
> table(d$month)

     1      2      3      4      5      6      7      8      9     10     11 
536408 491887 533604 505083 521408 501810 517437 504572 518096 537703 522217 
    12 
538059 
> 
> 
> #--------------------------------------------------------
> #Calculate stunting and wasting at enrollment and keep one observation per child
> #Also check if children without a recorded birthweight or birthlength have WAZ or HAZ in the first year of life
> #--------------------------------------------------------
> d <- d %>% group_by(studyid, subjid) %>% 
+   arrange(studyid, subjid, agedays) %>% 
+   filter(!is.na(haz)) %>%
+   mutate(enstunt= as.numeric(haz < -2),
+          enwast= as.numeric(whz < -2),
+          birthLAZ= haz,
+          birthWAZ= waz) %>%
+   #keep one observation per child
+   slice(1) 
> 
> table(is.na(d$birthwt), d$agedays > 7)
       
        FALSE  TRUE
  FALSE 66108 10661
  TRUE   4715 27882
> 
> #keep where anthro is measured on first 7 days, but birth anthro is not recorded
> d$birthLAZ[d$agedays>7] <- NA 
> d$birthWAZ[d$agedays>7] <- NA
> d$birthmeas_age <- NA
> d$birthmeas_age[d$agedays <= 7] <- d$agedays[d$agedays <= 7]
> 
> #Drop anthropometry measures (seperate long-form dataset used to calculate anthropometry outcomes)
> d <- d %>% subset(., select=-c(agedays, haz, waz, whz)) 
> 
> table(d$studyid, d$enwast)
                 
                      0     1
  Burkina Faso Zn  6533  1100
  CMC-V-BCS-2002    274    92
  CMIN              240    18
  COHORTS          9757  1923
  CONTENT           214     1
  EE                259    38
  GMS-Nepal         510   136
  Guatemala BSC     309     6
  iLiNS-DOSE       1901    30
  iLiNS-DYAD-M     1125    46
  iLiNS-Zinc       2717   549
  IRC               269   114
  JiVitA-3        20131  2564
  JiVitA-4         4518   443
  Keneba           2369   512
  LCNI-5            826    14
  MAL-ED           1651   160
  NIH-Birth         423   178
  NIH-Crypto        553   184
  PROBIT          13632  3259
  PROVIDE           544   148
  ResPak            223    48
  SAS-CompFeed     1218   155
  SAS-FoodSuppl     340    78
  TanzaniaChild2   2248   139
  VITAMIN-A        3299   606
  ZVITAMBO        10989  2240
> table(d$studyid, d$enstunt)
                 
                      0     1
  Burkina Faso Zn  5523  2110
  CMC-V-BCS-2002    296    77
  CMIN              168   111
  COHORTS         10664  1915
  CONTENT           195    20
  EE                213   167
  GMS-Nepal         575   123
  Guatemala BSC     239    76
  iLiNS-DOSE       1347   584
  iLiNS-DYAD-M      984   221
  iLiNS-Zinc       2533   733
  IRC               358    52
  JiVitA-3        18396  8967
  JiVitA-4         3887  1557
  Keneba           2612   342
  LCNI-5            531   309
  MAL-ED           1600   268
  NIH-Birth         530    99
  NIH-Crypto        653   105
  PROBIT          16766   132
  PROVIDE           633    67
  ResPak            202    82
  SAS-CompFeed     1089   444
  SAS-FoodSuppl     257   161
  TanzaniaChild2   2233   163
  VITAMIN-A        2780  1130
  ZVITAMBO        12550  1537
> 
> 
> 
> #--------------------------------------------------------
> #Merge in birthmonth from provide
> #--------------------------------------------------------
> 
> gc()
          used  (Mb) gc trigger   (Mb)  max used   (Mb)
Ncells 2195652 117.3    4465302  238.5   4465302  238.5
Vcells 9013149  68.8  673791618 5140.7 784711771 5986.9
> d$subjid <- as.numeric(d$subjid)
> gc()
          used  (Mb) gc trigger   (Mb)  max used   (Mb)
Ncells 2195321 117.3    4465302  238.5   4465302  238.5
Vcells 9012623  68.8  539033295 4112.5 784711771 5986.9
> 
> 
> provide <- readRDS(paste0(ghapdata_dir, "covariate creation intermediate datasets/derived covariate datasets/PROVIDE_birthmonth.rds"))
> provide$studyid <- "PROVIDE"
> provide$birthmon_provide <- as.numeric(as.character(provide$birthmon_provide))
> 
> unique(d$studyid)
 [1] "Burkina Faso Zn" "CMC-V-BCS-2002"  "CMIN"            "COHORTS"        
 [5] "CONTENT"         "EE"              "GMS-Nepal"       "Guatemala BSC"  
 [9] "iLiNS-DOSE"      "iLiNS-DYAD-M"    "iLiNS-Zinc"      "IRC"            
[13] "JiVitA-3"        "JiVitA-4"        "Keneba"          "LCNI-5"         
[17] "MAL-ED"          "NIH-Birth"       "NIH-Crypto"      "PROBIT"         
[21] "PROVIDE"         "ResPak"          "SAS-CompFeed"    "SAS-FoodSuppl"  
[25] "TanzaniaChild2"  "VITAMIN-A"       "ZVITAMBO"       
> table(is.na(d$brthmon[d$studyid=="PROVIDE"]))

TRUE 
 700 
> d <- left_join(d, provide, by = c("studyid", "subjid"))
Warning message:
Detecting old grouped_df format, replacing `vars` attribute by `groups` 
> table(d$birthmon_provide)

 1  2  3  4  5  6  7  8  9 10 11 12 
38 35 53 39 52 94 92 69 76 79 42 31 
> d$brthmon[d$studyid=="PROVIDE"] <- d$birthmon_provide[d$studyid=="PROVIDE"]
> table(is.na(d$brthmon[d$studyid=="PROVIDE"]))

FALSE 
  700 
> table((d$brthmon[d$studyid=="PROVIDE"]))

 1  2  3  4  5  6  7  8  9 10 11 12 
38 35 53 39 52 94 92 69 76 79 42 31 
> d <- d %>% subset(., select = -c(birthmon_provide))
> 
> 
> #--------------------------------------------------------
> # Merge in household assets-based wealth index
> # (Calculated from first principal component of a PCA analysis)
> # of asset indicators
> #--------------------------------------------------------
> 
> #convert subjid to character for the merge with covariate dataset
> d$subjid <- as.character(d$subjid)
> 
> #load in pca results
> pca <- readRDS(paste0(deriveddata_dir,"allGHAPstudies-HHwealth.rds"))
> 
> #Strip grant identifiers from study id's
> pca$studyid<- gsub("^k.*?-" , "", pca$studyid)
> 
> table(pca$studyid, pca$hhwealth_quart)
                
                 Wealth Q1 Wealth Q2 Wealth Q3 Wealth Q4
  AgaKhanUniv          174       170       171       172
  CMC-V-BCS-2002        91        95        91        96
  CONTENT               59        52        52        52
  GMS-Nepal            175       174       174       175
  iLiNS-DOSE           470       470       469       470
  iLiNS-DYAD-M         314       309       311       311
  IRC                  105       102       103       100
  JiVitA-3           11185     11187     11177     11158
  JiVitA-4            1374      1346      1362      1351
  LCNI-5               204       199       197       217
  MAL-ED               427       428       419       428
  PROVIDE              174       176       175       175
  TanzaniaChild2       719       486       590       593
> 
> #Merge into main dataframe
> pca <- as.data.frame(pca)
> pca$subjid <-as.character(pca$subjid)
> d <- left_join(d, pca, by=c("studyid", "country", "subjid"))
Warning message:
Column `country` joining character vector and factor, coercing into character vector 
> 
> #Note, only the COHORTS study has SES categories from a PCA, but no/incomplete indicators to calculate PCA from
> #Clean and merge that data here:
> #merge in ses variable for COHORTS for all countries except INDIA. The other countries have wealth based on 
> #an asset-based PCA index, but India is based on father's occupation.
> d$hhwealth_quart <- as.character(d$hhwealth_quart)
> chtses<- d$ses[is.na(d$hhwealth_quart) & d$studyid=="COHORTS" & d$country!="INDIA"]
> chtses[chtses==""] <- NA
> chtses[chtses=="Low"] <- "Wealth Q1"
> chtses[chtses=="Lower-mi"] <- "Wealth Q2"
> chtses[chtses=="Middle"] <- "Wealth Q3"
> chtses[chtses=="Upper-mi"] <- "Wealth Q4"
> chtses[chtses=="Upper"] <- "Wealth Q4"
> 
> d$hhwealth_quart[is.na(d$hhwealth_quart) & d$studyid=="COHORTS" & d$country!="INDIA"] <-chtses
> d$hhwealth_quart <- factor(d$hhwealth_quart)
> 
> #Check and make sure all merged correctly
> df <- d %>% filter(!is.na(hhwealth_quart)) %>% group_by(studyid, subjid) %>% slice(1)
> table(pca$studyid, pca$hhwealth_quart)
                
                 Wealth Q1 Wealth Q2 Wealth Q3 Wealth Q4
  AgaKhanUniv          174       170       171       172
  CMC-V-BCS-2002        91        95        91        96
  CONTENT               59        52        52        52
  GMS-Nepal            175       174       174       175
  iLiNS-DOSE           470       470       469       470
  iLiNS-DYAD-M         314       309       311       311
  IRC                  105       102       103       100
  JiVitA-3           11185     11187     11177     11158
  JiVitA-4            1374      1346      1362      1351
  LCNI-5               204       199       197       217
  MAL-ED               427       428       419       428
  PROVIDE              174       176       175       175
  TanzaniaChild2       719       486       590       593
> table(df$studyid, df$hhwealth_quart)
                
                 Wealth Q1 Wealth Q2 Wealth Q3 Wealth Q4
  CMC-V-BCS-2002        91        95        91        96
  COHORTS             1045       919      1359      1586
  CONTENT               59        52        52        52
  GMS-Nepal            175       174       174       175
  iLiNS-DOSE           470       470       468       470
  iLiNS-DYAD-M         299       300       301       305
  IRC                  105       102       103       100
  JiVitA-3            6628      6689      6841      7178
  JiVitA-4            1372      1345      1361      1350
  LCNI-5               204       199       197       217
  MAL-ED               427       428       419       428
  PROVIDE              174       176       175       175
  TanzaniaChild2       719       483       589       593
> 
> 
> 
> 
> #--------------------------------------------------------------------------
> # Code Food security
> #--------------------------------------------------------------------------
> 
> #Code into 3 harmonized categories (so that all 3 levels are present across all studies)
> # By recoding the levels from the HHS, HFAIS, and FAST scales into 3 categories
> table(d$studyid, d$hfoodsec)
                 
                        Deficit in whole year Deficit In Whole Year
  Burkina Faso Zn  7633                     0                     0
  CMC-V-BCS-2002    373                     0                     0
  CMIN              279                     0                     0
  COHORTS         12579                     0                     0
  CONTENT           215                     0                     0
  EE                380                     0                     0
  GMS-Nepal          24                     0                     0
  Guatemala BSC     315                     0                     0
  iLiNS-DOSE        147                     0                     0
  iLiNS-DYAD-M      488                     0                     0
  iLiNS-Zinc       3266                     0                     0
  IRC               410                     0                     0
  JiVitA-3         9972                     0                     0
  JiVitA-4           44                     0                     0
  Keneba           2954                     0                     0
  LCNI-5            840                     0                     0
  MAL-ED            859                     0                     0
  NIH-Birth           0                     6                     0
  NIH-Crypto          0                     0                    24
  PROBIT          16898                     0                     0
  PROVIDE           700                     0                     0
  ResPak            284                     0                     0
  SAS-CompFeed     1533                     0                     0
  SAS-FoodSuppl     418                     0                     0
  TanzaniaChild2   2396                     0                     0
  VITAMIN-A        3910                     0                     0
  ZVITAMBO        14087                     0                     0
                 
                  Food Insecure Food secure Food Secure Mildly Food Insecure
  Burkina Faso Zn             0           0           0                    0
  CMC-V-BCS-2002              0           0           0                    0
  CMIN                        0           0           0                    0
  COHORTS                     0           0           0                    0
  CONTENT                     0           0           0                    0
  EE                          0           0           0                    0
  GMS-Nepal                   0           0         479                    0
  Guatemala BSC               0           0           0                    0
  iLiNS-DOSE                  0           0         400                    0
  iLiNS-DYAD-M                0           0         204                    0
  iLiNS-Zinc                  0           0           0                    0
  IRC                         0           0           0                    0
  JiVitA-3                 2902        8702           0                 5787
  JiVitA-4                  702        2750           0                 1948
  Keneba                      0           0           0                    0
  LCNI-5                      0           0           0                    0
  MAL-ED                      0           0         607                    0
  NIH-Birth                   0           0           0                    0
  NIH-Crypto                  0           0           0                    0
  PROBIT                      0           0           0                    0
  PROVIDE                     0           0           0                    0
  ResPak                      0           0           0                    0
  SAS-CompFeed                0           0           0                    0
  SAS-FoodSuppl               0           0           0                    0
  TanzaniaChild2              0           0           0                    0
  VITAMIN-A                   0           0           0                    0
  ZVITAMBO                    0           0           0                    0
                 
                  Mildly Food Insecure Access Moderately Food Insecure Access
  Burkina Faso Zn                           0                               0
  CMC-V-BCS-2002                            0                               0
  CMIN                                      0                               0
  COHORTS                                   0                               0
  CONTENT                                   0                               0
  EE                                        0                               0
  GMS-Nepal                               106                              63
  Guatemala BSC                             0                               0
  iLiNS-DOSE                              149                             391
  iLiNS-DYAD-M                            130                             180
  iLiNS-Zinc                                0                               0
  IRC                                       0                               0
  JiVitA-3                                  0                               0
  JiVitA-4                                  0                               0
  Keneba                                    0                               0
  LCNI-5                                    0                               0
  MAL-ED                                   83                             214
  NIH-Birth                                 0                               0
  NIH-Crypto                                0                               0
  PROBIT                                    0                               0
  PROVIDE                                   0                               0
  ResPak                                    0                               0
  SAS-CompFeed                              0                               0
  SAS-FoodSuppl                             0                               0
  TanzaniaChild2                            0                               0
  VITAMIN-A                                 0                               0
  ZVITAMBO                                  0                               0
                 
                  Neither deficit nor surplus Neither Deficit Nor Surplus
  Burkina Faso Zn                           0                           0
  CMC-V-BCS-2002                            0                           0
  CMIN                                      0                           0
  COHORTS                                   0                           0
  CONTENT                                   0                           0
  EE                                        0                           0
  GMS-Nepal                                 0                           0
  Guatemala BSC                             0                           0
  iLiNS-DOSE                                0                           0
  iLiNS-DYAD-M                              0                           0
  iLiNS-Zinc                                0                           0
  IRC                                       0                           0
  JiVitA-3                                  0                           0
  JiVitA-4                                  0                           0
  Keneba                                    0                           0
  LCNI-5                                    0                           0
  MAL-ED                                    0                           0
  NIH-Birth                               492                           0
  NIH-Crypto                                0                         219
  PROBIT                                    0                           0
  PROVIDE                                   0                           0
  ResPak                                    0                           0
  SAS-CompFeed                              0                           0
  SAS-FoodSuppl                             0                           0
  TanzaniaChild2                            0                           0
  VITAMIN-A                                 0                           0
  ZVITAMBO                                  0                           0
                 
                  Severely Food Insecure Access Sometimes deficit
  Burkina Faso Zn                             0                 0
  CMC-V-BCS-2002                              0                 0
  CMIN                                        0                 0
  COHORTS                                     0                 0
  CONTENT                                     0                 0
  EE                                          0                 0
  GMS-Nepal                                  26                 0
  Guatemala BSC                               0                 0
  iLiNS-DOSE                                844                 0
  iLiNS-DYAD-M                              203                 0
  iLiNS-Zinc                                  0                 0
  IRC                                         0                 0
  JiVitA-3                                    0                 0
  JiVitA-4                                    0                 0
  Keneba                                      0                 0
  LCNI-5                                      0                 0
  MAL-ED                                    105                 0
  NIH-Birth                                   0                36
  NIH-Crypto                                  0                 0
  PROBIT                                      0                 0
  PROVIDE                                     0                 0
  ResPak                                      0                 0
  SAS-CompFeed                                0                 0
  SAS-FoodSuppl                               0                 0
  TanzaniaChild2                              0                 0
  VITAMIN-A                                   0                 0
  ZVITAMBO                                    0                 0
                 
                  Sometimes Deficit Surplus
  Burkina Faso Zn                 0       0
  CMC-V-BCS-2002                  0       0
  CMIN                            0       0
  COHORTS                         0       0
  CONTENT                         0       0
  EE                              0       0
  GMS-Nepal                       0       0
  Guatemala BSC                   0       0
  iLiNS-DOSE                      0       0
  iLiNS-DYAD-M                    0       0
  iLiNS-Zinc                      0       0
  IRC                             0       0
  JiVitA-3                        0       0
  JiVitA-4                        0       0
  Keneba                          0       0
  LCNI-5                          0       0
  MAL-ED                          0       0
  NIH-Birth                       0      95
  NIH-Crypto                     62     453
  PROBIT                          0       0
  PROVIDE                         0       0
  ResPak                          0       0
  SAS-CompFeed                    0       0
  SAS-FoodSuppl                   0       0
  TanzaniaChild2                  0       0
  VITAMIN-A                       0       0
  ZVITAMBO                        0       0
> unique(d$hfoodsec)
 [1] ""                                "Mildly Food Insecure Access"    
 [3] "Food Secure"                     "Severely Food Insecure Access"  
 [5] "Moderately Food Insecure Access" "Mildly Food Insecure"           
 [7] "Food secure"                     "Food Insecure"                  
 [9] "Neither deficit nor surplus"     "Surplus"                        
[11] "Sometimes deficit"               "Deficit in whole year"          
[13] "Neither Deficit Nor Surplus"     "Sometimes Deficit"              
[15] "Deficit In Whole Year"          
> 
> d$temp <- NA
> d$temp[d$hfoodsec=="Mildly Food Insecure"] <- "Mildly Food Insecure"
> d$temp[d$hfoodsec=="Food Insecure"] <- "Food Insecure"
> d$temp[d$hfoodsec=="Food secure"] <- "Food Secure"
> 
> d$temp[d$hfoodsec=="Neither Deficit Nor Surplus"] <- "Mildly Food Insecure"
> d$temp[d$hfoodsec=="Sometimes Deficit"] <- "Food Insecure"
> d$temp[d$hfoodsec=="Deficit In Whole Year"] <- "Food Insecure"
> d$temp[d$hfoodsec=="Surplus"] <- "Food Secure"
> 
> d$temp[d$hfoodsec=="Neither deficit nor surplus"] <- "Mildly Food Insecure"
> d$temp[d$hfoodsec=="Sometimes deficit"] <- "Food Insecure"
> d$temp[d$hfoodsec=="Deficit in whole year"] <- "Food Insecure"
> 
> d$temp[d$hfoodsec=="Mildly Food Insecure Access"] <- "Mildly Food Insecure"
> d$temp[d$hfoodsec=="Moderately Food Insecure Access"] <- "Food Insecure"
> d$temp[d$hfoodsec=="Severely Food Insecure Access"] <- "Food Insecure"
> d$temp[d$hfoodsec=="Food Secure"] <- "Food Secure"
> 
> table(d$studyid[!is.na(d$temp)], d$temp[!is.na(d$temp)])
              
               Food Insecure Food Secure Mildly Food Insecure
  GMS-Nepal               89         479                  106
  iLiNS-DOSE            1235         400                  149
  iLiNS-DYAD-M           383         204                  130
  JiVitA-3              2902        8702                 5787
  JiVitA-4               702        2750                 1948
  MAL-ED                 319         607                   83
  NIH-Birth               42          95                  492
  NIH-Crypto              86         453                  219
> 
> 
> d$hfoodsec <- d$temp
> d <- d %>% subset(., select=-c(temp))
> 
> table(d$studyid, d$hfoodsec)
                 
                  Food Insecure Food Secure Mildly Food Insecure
  Burkina Faso Zn             0           0                    0
  CMC-V-BCS-2002              0           0                    0
  CMIN                        0           0                    0
  COHORTS                     0           0                    0
  CONTENT                     0           0                    0
  EE                          0           0                    0
  GMS-Nepal                  89         479                  106
  Guatemala BSC               0           0                    0
  iLiNS-DOSE               1235         400                  149
  iLiNS-DYAD-M              383         204                  130
  iLiNS-Zinc                  0           0                    0
  IRC                         0           0                    0
  JiVitA-3                 2902        8702                 5787
  JiVitA-4                  702        2750                 1948
  Keneba                      0           0                    0
  LCNI-5                      0           0                    0
  MAL-ED                    319         607                   83
  NIH-Birth                  42          95                  492
  NIH-Crypto                 86         453                  219
  PROBIT                      0           0                    0
  PROVIDE                     0           0                    0
  ResPak                      0           0                    0
  SAS-CompFeed                0           0                    0
  SAS-FoodSuppl               0           0                    0
  TanzaniaChild2              0           0                    0
  VITAMIN-A                   0           0                    0
  ZVITAMBO                    0           0                    0
> 
> d$hfoodsec <- factor(d$hfoodsec, levels=c("Food Secure", "Mildly Food Insecure", "Food Insecure"))
> 
> 
> 
> #--------------------------------------------------------------------------
> # birth characteristics
> #--------------------------------------------------------------------------
> 
> 
> # drop gestational age in studies with no variations (measured it at the month level)
> d$gagebrth[d$studyid=="GMS-Nepal"] <- NA
> #drop gestational age in study where GA is mother reported and unbelievably high (93% and 80% preterm)
> d$gagebrth[d$studyid=="SAS-CompFeed"] <- NA
> d$gagebrth[d$studyid=="EE"] <- NA
> 
> 
> #parity
> #Combine parity and birthorder to have sufficient data to analyze
> #Parity (which includes stillborns past a certain gestational age) is assumed
> #to approximate child birth order
> table(d$studyid[!is.na(d$parity)], d$parity[!is.na(d$parity)])
                 
                      1     2     3     4     5     6     7     8     9    10
  Burkina Faso Zn  1321  1197   992  1355     0  1093     0     0   283     0
  COHORTS          1822  2198  1917  3806     0     0     0     0     0     0
  GMS-Nepal         211   181   128    89    48    19     5     9     4     3
  iLiNS-DYAD-M        0   215   269   262   205   158    63    24     6     3
  JiVitA-3            0 10327  9027  4737  2018   760   295   123    43    19
  Keneba              0   241   215   233   238   223   231   173   125   129
  PROVIDE           271   244   103    50    21     6     3     1     0     1
  TanzaniaChild2      6   821   771   460   192    82    21     7     2     0
  ZVITAMBO         6076  4215  1998   969   463   220    90    30    14    10
                 
                     11    12    13    14    15    16    18    20
  Burkina Faso Zn     0     0     0     0     0     0     0     0
  COHORTS             0     0     0     0     0     0     0     0
  GMS-Nepal           1     0     0     0     0     0     0     0
  iLiNS-DYAD-M        0     0     0     0     0     0     0     0
  JiVitA-3            7     5     1     0     1     0     0     0
  Keneba             94    54    30     6     4     2     0     2
  PROVIDE             0     0     0     0     0     0     0     0
  TanzaniaChild2      0     0     0     0     0     0     1     0
  ZVITAMBO            1     0     0     0     0     0     0     0
> table(d$studyid[!is.na(d$brthordr)], d$brthordr[!is.na(d$brthordr)])
               
                  0   1   2   3   4   5   6   7   8   9  10  12
  SAS-CompFeed    0 452 360 316 188 113  55  19  20   8   1   1
  SAS-FoodSuppl  21  77  92  74  54  58  23  11   5   1   2   0
> 
> d$parity[is.na(d$parity)] <- d$brthordr[is.na(d$parity)]
> 
> 
> #Shift obs in SAS-FoodSuppl to make 1==firstborn
> d$parity[d$studyid=="SAS-FoodSuppl"] <- d$parity[d$studyid=="SAS-FoodSuppl"] + 1   
> 
> #Fix right shift of Tanzania child, Kenaba, iLiNS-DYAD-M, and Jivita-3 parity
> d$parity[d$studyid=="TanzaniaChild2" & d$parity==1] <- NA
> d$parity[d$studyid=="TanzaniaChild2"] <- d$parity[d$studyid=="TanzaniaChild2"] - 1  
> d$parity[d$studyid=="Keneba"] <- d$parity[d$studyid=="Keneba"] - 1  
> d$parity[d$studyid=="iLiNS-DYAD-M"] <- d$parity[d$studyid=="iLiNS-DYAD-M"] - 1  
> d$parity[d$studyid=="JiVitA-3"] <- d$parity[d$studyid=="JiVitA-3"] - 1  
> table(d$studyid, d$parity)
                 
                      1     2     3     4     5     6     7     8     9    10
  Burkina Faso Zn  1321  1197   992  1355     0  1093     0     0   283     0
  CMC-V-BCS-2002      0     0     0     0     0     0     0     0     0     0
  CMIN                0     0     0     0     0     0     0     0     0     0
  COHORTS          1822  2198  1917  3806     0     0     0     0     0     0
  CONTENT             0     0     0     0     0     0     0     0     0     0
  EE                  0     0     0     0     0     0     0     0     0     0
  GMS-Nepal         211   181   128    89    48    19     5     9     4     3
  Guatemala BSC       0     0     0     0     0     0     0     0     0     0
  iLiNS-DOSE          0     0     0     0     0     0     0     0     0     0
  iLiNS-DYAD-M      215   269   262   205   158    63    24     6     3     0
  iLiNS-Zinc          0     0     0     0     0     0     0     0     0     0
  IRC                 0     0     0     0     0     0     0     0     0     0
  JiVitA-3        10327  9027  4737  2018   760   295   123    43    19     7
  JiVitA-4            0     0     0     0     0     0     0     0     0     0
  Keneba            241   215   233   238   223   231   173   125   129    94
  LCNI-5              0     0     0     0     0     0     0     0     0     0
  MAL-ED              0     0     0     0     0     0     0     0     0     0
  NIH-Birth           0     0     0     0     0     0     0     0     0     0
  NIH-Crypto          0     0     0     0     0     0     0     0     0     0
  PROBIT              0     0     0     0     0     0     0     0     0     0
  PROVIDE           271   244   103    50    21     6     3     1     0     1
  ResPak              0     0     0     0     0     0     0     0     0     0
  SAS-CompFeed      452   360   316   188   113    55    19    20     8     1
  SAS-FoodSuppl      21    77    92    74    54    58    23    11     5     1
  TanzaniaChild2    821   771   460   192    82    21     7     2     0     0
  VITAMIN-A           0     0     0     0     0     0     0     0     0     0
  ZVITAMBO         6076  4215  1998   969   463   220    90    30    14    10
                 
                     11    12    13    14    15    17    19
  Burkina Faso Zn     0     0     0     0     0     0     0
  CMC-V-BCS-2002      0     0     0     0     0     0     0
  CMIN                0     0     0     0     0     0     0
  COHORTS             0     0     0     0     0     0     0
  CONTENT             0     0     0     0     0     0     0
  EE                  0     0     0     0     0     0     0
  GMS-Nepal           1     0     0     0     0     0     0
  Guatemala BSC       0     0     0     0     0     0     0
  iLiNS-DOSE          0     0     0     0     0     0     0
  iLiNS-DYAD-M        0     0     0     0     0     0     0
  iLiNS-Zinc          0     0     0     0     0     0     0
  IRC                 0     0     0     0     0     0     0
  JiVitA-3            5     1     0     1     0     0     0
  JiVitA-4            0     0     0     0     0     0     0
  Keneba             54    30     6     4     2     0     2
  LCNI-5              0     0     0     0     0     0     0
  MAL-ED              0     0     0     0     0     0     0
  NIH-Birth           0     0     0     0     0     0     0
  NIH-Crypto          0     0     0     0     0     0     0
  PROBIT              0     0     0     0     0     0     0
  PROVIDE             0     0     0     0     0     0     0
  ResPak              0     0     0     0     0     0     0
  SAS-CompFeed        0     1     0     0     0     0     0
  SAS-FoodSuppl       2     0     0     0     0     0     0
  TanzaniaChild2      0     0     0     0     0     1     0
  VITAMIN-A           0     0     0     0     0     0     0
  ZVITAMBO            1     0     0     0     0     0     0
> 
> #Convert birth Zscore to absolute units
> table(d$studyid, is.na(d$birthlen))
                 
                  FALSE  TRUE
  Burkina Faso Zn     0  7633
  CMC-V-BCS-2002    103   270
  CMIN                0   279
  COHORTS         10547  2032
  CONTENT             0   215
  EE                  0   380
  GMS-Nepal           0   698
  Guatemala BSC       0   315
  iLiNS-DOSE          0  1931
  iLiNS-DYAD-M        0  1205
  iLiNS-Zinc          0  3266
  IRC               391    19
  JiVitA-3        21017  6346
  JiVitA-4         4483   961
  Keneba           1550  1404
  LCNI-5              0   840
  MAL-ED             54  1814
  NIH-Birth           0   629
  NIH-Crypto        758     0
  PROBIT          16898     0
  PROVIDE           700     0
  ResPak              0   284
  SAS-CompFeed     1520    13
  SAS-FoodSuppl       0   418
  TanzaniaChild2      0  2396
  VITAMIN-A           0  3910
  ZVITAMBO        13949   138
> table(d$studyid, is.na(d$birthwt))
                 
                  FALSE  TRUE
  Burkina Faso Zn     0  7633
  CMC-V-BCS-2002    365     8
  CMIN                0   279
  COHORTS         10735  1844
  CONTENT             0   215
  EE                379     1
  GMS-Nepal           0   698
  Guatemala BSC       0   315
  iLiNS-DOSE          0  1931
  iLiNS-DYAD-M     1028   177
  iLiNS-Zinc          0  3266
  IRC               404     6
  JiVitA-3        21362  6001
  JiVitA-4         4508   936
  Keneba              0  2954
  LCNI-5              0   840
  MAL-ED           1697   171
  NIH-Birth           0   629
  NIH-Crypto        758     0
  PROBIT          16898     0
  PROVIDE           700     0
  ResPak              0   284
  SAS-CompFeed     1523    10
  SAS-FoodSuppl       0   418
  TanzaniaChild2   2371    25
  VITAMIN-A           0  3910
  ZVITAMBO        14041    46
> 
> #sex must be "Male" or "Female" for growthstandards package
> table(d$sex)

Female   Male 
 53418  55948 
> table(is.na(d$sex))

 FALSE 
109366 
> 
> #Use agedays-1 as function codes birth age=0
> d$birthlen2 <- who_zscore2htcm(d$birthmeas_age-1, d$birthLAZ, sex = d$sex)
> d$birthwt2 <- who_zscore2wtkg(d$birthmeas_age-1, d$birthWAZ, sex = d$sex) * 1000
> d$birthlen2[!is.finite(d$birthlen2)] <- NA
> d$birthwt2[!is.finite(d$birthwt2)] <- NA
> 
> 
> 
> #Check if children without a recorded birthweight or birthlength have WAZ or HAZ in the first 7 days of life
> #and add into birthweight variable
> 
> summary(d$birthlen)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  21.80   46.80   48.70   48.76   50.90   68.00   37396 
> summary(d$birthlen2)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  21.81   46.60   48.41   48.51   50.10   65.01   38546 
> summary(d$birthwt)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
    620    2560    2920    2945    3300    7000   32597 
> summary(d$birthwt2)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  619.8  2511.7  2872.2  2886.5  3225.7  5653.1   38727 
> 
> table(is.na(d$birthlen), is.na(d$birthlen2))
       
        FALSE  TRUE
  FALSE 66840  5130
  TRUE   3980 33416
> table(is.na(d$birthwt), is.na(d$birthwt2))
       
        FALSE  TRUE
  FALSE 66107 10662
  TRUE   4532 28065
> 
> d$birthlen[is.na(d$birthlen)] <- d$birthlen2[is.na(d$birthlen)]
> d$birthwt[is.na(d$birthwt)] <- d$birthwt2[is.na(d$birthwt)]
> 
> 
> table(d$studyid, is.na(d$birthlen))
                 
                  FALSE  TRUE
  Burkina Faso Zn     0  7633
  CMC-V-BCS-2002    106   267
  CMIN               26   253
  COHORTS         10547  2032
  CONTENT             2   213
  EE                242   138
  GMS-Nepal         697     1
  Guatemala BSC       0   315
  iLiNS-DOSE          0  1931
  iLiNS-DYAD-M       23  1182
  iLiNS-Zinc          0  3266
  IRC               391    19
  JiVitA-3        22555  4808
  JiVitA-4         4483   961
  Keneba           1552  1402
  LCNI-5              0   840
  MAL-ED            851  1017
  NIH-Birth         608    21
  NIH-Crypto        758     0
  PROBIT          16898     0
  PROVIDE           700     0
  ResPak             42   242
  SAS-CompFeed     1520    13
  SAS-FoodSuppl       0   418
  TanzaniaChild2      0  2396
  VITAMIN-A           0  3910
  ZVITAMBO        13949   138
> table(d$studyid, is.na(d$birthwt))
                 
                  FALSE  TRUE
  Burkina Faso Zn     0  7633
  CMC-V-BCS-2002    365     8
  CMIN               26   253
  COHORTS         10735  1844
  CONTENT             2   213
  EE                379     1
  GMS-Nepal         697     1
  Guatemala BSC       0   315
  iLiNS-DOSE          0  1931
  iLiNS-DYAD-M     1030   175
  iLiNS-Zinc          0  3266
  IRC               404     6
  JiVitA-3        22899  4464
  JiVitA-4         4508   936
  Keneba           1538  1416
  LCNI-5              0   840
  MAL-ED           1777    91
  NIH-Birth         608    21
  NIH-Crypto        758     0
  PROBIT          16898     0
  PROVIDE           700     0
  ResPak             42   242
  SAS-CompFeed     1523    10
  SAS-FoodSuppl       0   418
  TanzaniaChild2   2371    25
  VITAMIN-A           0  3910
  ZVITAMBO        14041    46
> 
> #fix 8 observations in CMC cohort with missing birthweight that still have missingess code (9998) rather than NA
> table(df$birthwt==9998)

FALSE 
36154 
> df$birthwt[df$birthwt==9998] <- NA
> #--------------------------------------------------------------------------
> # parental characteristics
> #--------------------------------------------------------------------------
> 
> #single mom
> table(d$studyid[!is.na(d$single)], d$single[!is.na(d$single)])
                
                     0     1
  COHORTS         9997   243
  Guatemala BSC    252    30
  iLiNS-DOSE      1203   674
  iLiNS-DYAD-M     976   229
  JiVitA-4        5417     8
  MAL-ED          1647   219
  PROBIT         16205   693
  TanzaniaChild2  2151   224
  ZVITAMBO       13139   890
> 
> 
> #Merge in post-birth weight measures for jivita-3 and sas-compfeed
> mat_weight <- readRDS(paste0(ghapdata_dir,"covariate creation intermediate datasets/derived covariate datasets/maternal_weight_dataset.RDS"))
> #Strip grant identifiers from study id's
> mat_weight$studyid<- gsub("^k.*?-" , "", mat_weight$studyid)
> 
> head(mat_weight)
# A tibble: 6 x 3
  subjid mwtkg studyid 
   <dbl> <dbl> <chr>   
1      1  33.8 JiVitA-3
2      2  49.7 JiVitA-3
3      3  47.2 JiVitA-3
4      4  35.2 JiVitA-3
5      5  44   JiVitA-3
6      6  38.5 JiVitA-3
> mat_weight <- mat_weight %>% rename(post_birth_weight=mwtkg)
> mat_weight$subjid <- as.character(mat_weight$subjid)
> 
> d <- left_join(d, mat_weight, by = c("studyid", "subjid"))
> summary(mat_weight$post_birth_weight)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  26.80   40.40   44.00   44.85   48.30   88.80     537 
> summary(d$post_birth_weight)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  26.80   40.70   44.40   45.23   48.80   81.20   91246 
> d$mwtkg[!is.na(d$post_birth_weight)] <- d$post_birth_weight[!is.na(d$post_birth_weight)]
> 
> #Set BMI to missing for these studies, then recalculate below
> d$mbmi[!is.na(d$post_birth_weight)] <- NA
> d <- d %>% subset(., select = -c(post_birth_weight))
> 
> #Calculate bmi from height and weight, and vice versa, for when only 2 of 3 are measured
> #bmi
> flag <- is.na(d$mbmi) & !is.na(d$mhtcm) & !is.na(d$mwtkg)
> d$mbmi[flag] <- d$mwtkg[flag] / (d$mhtcm[flag] / 100)^2
> 
> #weight
> flag <- is.na(d$mwtkg) & !is.na(d$mhtcm) & !is.na(d$mbmi)
> d$mwtkg[flag] <- d$mbmi[flag] * (d$mhtcm[flag] / 100)^2
> 
> #height
> flag <- is.na(d$mhtcm) & !is.na(d$mwtkg) & !is.na(d$mbmi)
> d$mhtcm[flag] <- sqrt(d$mwtkg[flag] / d$mbmi[flag]) * 100
> 
> summary(d$mbmi)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  11.56   18.95   20.94   21.62   23.47  892.33   38528 
> summary(d$mwtkg)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  26.60   43.90   50.73   52.94   59.70  168.00   36278 
> summary(d$mhtcm)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   41.0   149.7   155.0   155.5   161.2   199.0   28477 
> 
> 
> table(d$studyid, !is.na(d$mbmi))
                 
                  FALSE  TRUE
  Burkina Faso Zn  1691  5942
  CMC-V-BCS-2002    373     0
  CMIN              279     0
  COHORTS         12579     0
  CONTENT           215     0
  EE                380     0
  GMS-Nepal         698     0
  Guatemala BSC     315     0
  iLiNS-DOSE         10  1921
  iLiNS-DYAD-M       10  1195
  iLiNS-Zinc         49  3217
  IRC               410     0
  JiVitA-3          126 27237
  JiVitA-4         5444     0
  Keneba           2954     0
  LCNI-5              3   837
  MAL-ED             97  1771
  NIH-Birth           0   629
  NIH-Crypto          3   755
  PROBIT           3170 13728
  PROVIDE            31   669
  ResPak            284     0
  SAS-CompFeed      760  8779
  SAS-FoodSuppl     418     0
  TanzaniaChild2     51  2345
  VITAMIN-A        3910     0
  ZVITAMBO         4268  9819
> 
> #--------------------------------------------------------------------------
> # house characteristics
> #--------------------------------------------------------------------------
> 
> #set to missing any observations of 0 rooms
> d$nrooms[d$nrooms==0] <- NA
> 
> #check the number of children < 5 and set to missing if 0
> table(d$nchldlt5)

    0     1     2     3     4     5     6     7     8     9    10    11 
20360 12827  3263   814   297    87    23     7     1     3     1     1 
> table(d$studyid[!is.na(d$nchldlt5)], d$nchldlt5[!is.na(d$nchldlt5)])
                
                     0     1     2     3     4     5     6     7     8     9
  iLiNS-DOSE         3   845   816   119    24     5     2     0     0     0
  iLiNS-DYAD-M      63   163    40     7     4     0     1     0     0     0
  iLiNS-Zinc         0  1073  1272   525   231    68    15     4     1     0
  IRC               89   119   100    62    22    12     4     2     0     0
  JiVitA-3       17511  9180   596    41     4     1     0     0     0     0
  LCNI-5             4   391   358    51     9     1     0     1     0     0
  NIH-Crypto       541   211     6     0     0     0     0     0     0     0
  PROVIDE          512   176    12     0     0     0     0     0     0     0
  TanzaniaChild2  1637   669    63     9     3     0     1     0     0     3
                
                    10    11
  iLiNS-DOSE         0     0
  iLiNS-DYAD-M       1     0
  iLiNS-Zinc         0     0
  IRC                0     0
  JiVitA-3           0     0
  LCNI-5             0     1
  NIH-Crypto         0     0
  PROVIDE            0     0
  TanzaniaChild2     0     0
> 
> #Need to shift full distribution by 1 in studies with 0 marked- 
> #  inconsistent marking of subject in the count across studies
> #  Some count number of other children, some number of total children
> d$nchldlt5[d$studyid=="LCNI-5" & d$nchldlt5==0] <- NA #LCNI has 4 children marked as 0 -drop as
> d$nchldlt5[d$studyid=="iLiNS-DOSE" & d$nchldlt5==0] <- NA #ilins-DOSE has 3 children marked as 0 -drop as
> d$nchldlt5[d$studyid=="IRC"] <- d$nchldlt5[d$studyid=="IRC"] + 1
> d$nchldlt5[d$studyid=="PROVIDE"] <- d$nchldlt5[d$studyid=="PROVIDE"] + 1
> d$nchldlt5[d$studyid=="NIH-Crypto"] <- d$nchldlt5[d$studyid=="NIH-Crypto"] + 1
> d$nchldlt5[d$studyid=="TanzaniaChild2"] <- d$nchldlt5[d$studyid=="TanzaniaChild2"] + 1
> d$nchldlt5[d$studyid=="iLiNS-DYAD-M"] <- d$nchldlt5[d$studyid=="iLiNS-DYAD-M"] + 1
> d$nchldlt5[d$studyid=="JiVitA-3"] <- d$nchldlt5[d$studyid=="JiVitA-3"] + 1
> 
> 
> 
> 
> #--------------------------------------------------------
> # create id variable for unit of independent observation
> # (At level of child for most studies, but some trials are cluster-randomized)
> #--------------------------------------------------------
> 
> d$id <- NA
> d$id[d$studyid %in% c("iLiNS-Zinc",
+                       "JiVitA-3",    
+                       "JiVitA-4",
+                       "PROBIT",
+                       "SAS-CompFeed")] <-d$clustid[d$studyid %in% c("iLiNS-Zinc",
+                                                                                "JiVitA-3",    
+                                                                                "JiVitA-4",
+                                                                                "PROBIT",
+                                                                                "SAS-CompFeed")]
> d$id[!(d$studyid %in% c("iLiNS-Zinc",
+                         "JiVitA-3",    
+                         "JiVitA-4",
+                         "PROBIT",
+                         "SAS-CompFeed"))] <-d$subjid[!(d$studyid %in% c("iLiNS-Zinc",
+                                                                                    "JiVitA-3",    
+                                                                                    "JiVitA-4",
+                                                                                    "PROBIT",
+                                                                                    "SAS-CompFeed"))]
> 
> #use siteid from PROBIT
> d$id[d$studyid %in% c("PROBIT")] <-d$siteid[d$studyid %in% c("PROBIT")]
> 
> table(is.na(d$id))

 FALSE 
117372 
> 
> 
> #--------------------------------------------------------
> # Classify intervention arms (used in initially-planned analysis)
> # Of intervention effects that was scrapped, but also as adjustment variables
> #--------------------------------------------------------
> 
> arms <- d %>% filter(arm!="") %>% group_by(studyid) %>% do(levels = unique(.$arm))
> arms
Source: local data frame [16 x 2]
Groups: <by row>

# A tibble: 16 x 2
   studyid         levels   
 * <chr>           <list>   
 1 Burkina Faso Zn <chr [4]>
 2 COHORTS         <chr [2]>
 3 Guatemala BSC   <chr [4]>
 4 iLiNS-DOSE      <chr [6]>
 5 iLiNS-DYAD-M    <chr [3]>
 6 iLiNS-Zinc      <chr [5]>
 7 JiVitA-3        <chr [2]>
 8 JiVitA-4        <chr [5]>
 9 LCNI-5          <chr [4]>
10 PROBIT          <chr [2]>
11 PROVIDE         <chr [4]>
12 SAS-CompFeed    <chr [2]>
13 SAS-FoodSuppl   <chr [4]>
14 TanzaniaChild2  <chr [4]>
15 VITAMIN-A       <chr [2]>
16 ZVITAMBO        <chr [4]>
> 
> 
> d$tr <- NA
> 
> d$tr[d$studyid=="Serrinha-VitA" & d$arm=="Placebo"] <- "Control"
> d$tr[d$studyid=="Serrinha-VitA" & d$arm=="Vitamin A"] <- "VitA"
> 
> d$tr[(d$studyid=="WASH-Bangladesh" | d$studyid=="WASH-Kenya")] <- "Other"
> d$tr[(d$studyid=="WASH-Bangladesh" | d$studyid=="WASH-Kenya") & (d$arm=="Control" | d$arm=="Passive Control")] <- "Control"
> d$tr[(d$studyid=="WASH-Bangladesh" | d$studyid=="WASH-Kenya") & (d$arm=="Nutrition" | d$arm=="Nutrition + WSH")] <- "LNS"
> 
> d$tr[d$studyid=="AgaKhanUniv" & d$arm=="Control"] <- "Control"
> d$tr[d$studyid=="AgaKhanUniv" & d$arm=="Intervention"] <- "Maternal"
> 
> d$tr[d$studyid=="EU" & d$arm=="Placebo"] <- "Control"
> d$tr[d$studyid=="EU" & d$arm=="Zinc"] <- "Zinc"
> 
> d$tr[d$studyid=="VITAMIN-A" & d$arm=="Control"] <- "Control"
> d$tr[d$studyid=="VITAMIN-A" & d$arm=="Vitamin A"] <- "VitA"
> 
> d$tr[d$studyid=="Vitamin-B12" ] <- "Other"
> d$tr[d$studyid=="Vitamin-B12" & d$arm=="Placebo"] <- "Control"
> 
> d$tr[d$studyid=="ZnMort" & d$arm=="IFA"] <- "Control"
> d$tr[d$studyid=="ZnMort" & d$arm=="Zinc+IFA"] <- "Zinc"
> 
> d$tr[d$studyid=="SAS-CompFeed" & d$arm=="Control"] <- "Control"
> d$tr[d$studyid=="SAS-CompFeed" & (d$arm=="Intervention"|d$arm=="")] <- "Other"
> 
> d$tr[d$studyid=="SAS-FoodSuppl" ] <- "Other"
> d$tr[d$studyid=="SAS-FoodSuppl" & d$arm=="No intervention"] <- "Control"
> 
> d$tr[d$studyid=="PROVIDE" ] <- "Other"
> d$tr[d$studyid=="PROVIDE" & d$arm=="No Rotarix + No IPV (175)"] <- "Control"
> 
> d$tr[d$studyid=="TanzaniaChild2" & d$arm=="Control"] <- "Control"
> d$tr[d$studyid=="TanzaniaChild2" & d$arm=="Multivitamin Alone"] <- "Other"
> d$tr[d$studyid=="TanzaniaChild2" & (d$arm=="Zinc Alone" | d$arm=="Zinc + Multivitamin")] <- "Zinc"
> 
> d$tr[d$studyid=="Burkina Faso Zn" ] <- "Zinc"
> d$tr[d$studyid=="Burkina Faso Zn" & d$arm=="Control (no Zinc)"] <- "Control"
> 
> d$tr[d$studyid=="Guatemala BSC" ] <- "Other"
> d$tr[d$studyid=="Guatemala BSC" & (d$arm=="WPC"|d$arm=="MNT + WPC")] <- "Control"
> 
> d$tr[d$studyid=="iLiNS-Zinc" ] <- "LNS"
> d$tr[d$studyid=="iLiNS-Zinc" & d$arm=="e.Control"] <- "Control"
> 
> #Create secondary dataset for Zinc+LNS vs LNS contrast
> iLiNS_Zinc_df <- d[d$studyid=="iLiNS-Zinc" & d$arm!="e.Control", ]
> iLiNS_Zinc_df$tr <- "Zinc"
> iLiNS_Zinc_df$tr[iLiNS_Zinc_df$arm=="a.LNS-Zn0"] <- "Control"
> iLiNS_Zinc_df$studyid <- "iLiNS-Zinc_ZvLNS"
> 
> d$tr[d$studyid=="PROBIT" ] <- "Maternal"
> d$tr[d$studyid=="PROBIT" & d$arm=="Control group"] <- "Control"
> 
> d$tr[d$studyid=="ZVITAMBO" ] <- "VitA"
> d$tr[d$studyid=="ZVITAMBO" & d$arm=="Placebo nippled + Placebo Oval"] <- "Control"
> 
> 
> d$tr[d$studyid=="COHORTS" & d$arm=="Control"] <- "Control"
> d$tr[d$studyid=="COHORTS" & d$arm=="Intervention"] <- "Other"
> 
> d$tr[d$studyid=="iLiNS-DOSE" & d$arm=="Control"] <- "Control"
> d$tr[d$studyid=="iLiNS-DOSE" & d$arm!="Control"] <- "LNS"
> 
> d$tr[d$studyid=="iLiNS-DYAD-M" & d$arm=="Iron and folic acid supplementation"] <- "Control"
> d$tr[d$studyid=="iLiNS-DYAD-M" & d$arm!="Iron and folic acid supplementation"] <- "Maternal"
> 
> 
> iLiNS_DYADM_df <- d[d$studyid=="iLiNS-DYAD-M" & d$arm!="Multiple micronutrient supplementation", ]
> iLiNS_DYADM_df$tr <- "Control"
> iLiNS_DYADM_df$tr[iLiNS_DYADM_df$arm!="Iron and folic acid supplementation"] <- "LNS"
> iLiNS_DYADM_df$studyid <- "iLiNS_DYADM_LNS"
> 
> d$tr[d$studyid=="LCNI-5"& d$arm=="Standard(Control)"] <- "Control"
> d$tr[d$studyid=="LCNI-5"& (d$arm=="Milk FS"|d$arm=="Soy FS")] <- "LNS"
> d$tr[d$studyid=="LCNI-5"& d$arm=="Likuni Phala"] <- "Other"
> 
> d$tr[d$studyid=="JiVitA-3" & d$arm=="Iron Folic Acid"] <- "Control"
> d$tr[d$studyid=="JiVitA-3" & d$arm=="Multiple Micronutrients"] <- "Maternal"
> 
> d$tr[d$studyid=="JiVitA-4"] <- "Other"
> d$tr[d$studyid=="JiVitA-4" & d$arm=="CFC"] <- "Control"
> d$tr[d$studyid=="JiVitA-4" & d$arm=="Plumpy Doz"] <- "LNS"
> 
> 
> 
> #--------------------------------------------------------
> # Drop risk factors without enough studies or unneeded/temporary variables 
> #--------------------------------------------------------
> 
> colnames(d)
 [1] "studyid"        "subjid"         "sex"            "month"         
 [5] "wtkg"           "htcm"           "lencm"          "hcircm"        
 [9] "muaccm"         "muaz"           "siteid"         "ctrycd"        
[13] "country"        "region"         "citytown"       "latitude"      
[17] "longitud"       "clustid"        "arm"            "tr"            
[21] "gagebrth"       "dead"           "agedth"         "causedth"      
[25] "brthyr"         "brthweek"       "brthmon"        "parity"        
[29] "brthordr"       "birthwt"        "birthlen"       "vagbrth"       
[33] "hdlvry"         "mage"           "mhtcm"          "mwtkg"         
[37] "mbmi"           "meducyrs"       "single"         "fage"          
[41] "fhtcm"          "feducyrs"       "trth2o"         "cleanck"       
[45] "impfloor"       "nrooms"         "nhh"            "nchldlt5"      
[49] "ses"            "earlybf"        "hfoodsec"       "measurefreq"   
[53] "anywast06"      "pers_wast"      "enstunt"        "enwast"        
[57] "birthLAZ"       "birthWAZ"       "birthmeas_age"  "hhwealth_quart"
[61] "birthlen2"      "birthwt2"       "id"            
> d <- subset(d, select = -c(brthweek,   brthordr, 
+                            ses, birthlen2, birthwt2, 
+                            birthmeas_age, birthLAZ, birthWAZ))
> 
> #--------------------------------------------------------
> # Convert continious variables to quartiled categorical 
> # variables for use as primary exposures
> #--------------------------------------------------------
> 
> 
> 
> #quantiling functions
> quantile_rf <- function(data, A, labs=NULL, Acuts=NULL, units=NULL){
+   A<-as.numeric(A)
+   if(sum(is.na(A))!=length(A)){
+     if(is.null(Acuts)){
+       Acuts=c(0, as.numeric(quantile(A, probs = c(.25,.5,.75), na.rm=T)), max(A, na.rm=T))
+     }
+     
+     if(length(Acuts)==3){
+       Alevels=c(paste0("<",round(Acuts[2],2)), 
+                 paste0(">=",round(Acuts[2],2))) 
+     }    
+     if(length(Acuts)==4){
+       Alevels=c(paste0("<",round(Acuts[2],2)), 
+                 paste0("[",round(Acuts[2],2),"-",round(Acuts[3],2),")"),
+                 paste0(">=",round(Acuts[3],2))) 
+     }
+     if(length(Acuts)==5){
+       Alevels=c(paste0("<",round(Acuts[2],2)), 
+                 paste0("[",round(Acuts[2],2),"-",round(Acuts[3],2),")"),
+                 paste0("[",round(Acuts[3],2),"-",round(Acuts[4],2),")"), 
+                 paste0(">=",round(Acuts[4],2))) 
+     }
+     if(length(Acuts)==6){
+       Alevels=c(paste0("<",round(Acuts[2],2)), 
+                 paste0("[",round(Acuts[2],2),"-",round(Acuts[3],2),")"),
+                 paste0("[",round(Acuts[3],2),"-",round(Acuts[4],2),")"),
+                 paste0("[",round(Acuts[4],2),"-",round(Acuts[5],2),")"), 
+                 paste0(">=",round(Acuts[5],2))) 
+     }    
+     
+     
+     if(!is.null(labs)){
+       Alevels=labs
+     }
+     if(!is.null(units)){
+       Alevels=paste0(Alevels, " ", units)
+     }
+     
+     if(length(unique(Acuts))==length((Acuts))){
+       A <- cut(A, include.lowest = T, right = FALSE, breaks=Acuts,labels=Alevels)
+     }else{
+       A <- cut(A, include.lowest = T, right = FALSE, breaks=4,labels=c("Q1","Q2","Q3","Q4","Q5")[1:(length(Acuts)-1)])
+     }
+     A <- factor(A)
+     
+     printdf <- data.frame(id=paste0(data$studyid," ", data$country), A)
+     printdf <- printdf %>% filter(!is.na(A))
+     printdf <- droplevels(printdf) 
+     print(table(printdf$id, printdf$A))
+     
+     print(table( printdf$A))
+     return(A)
+   }
+ }
> 
> 
> #A-priori categorical levels
>   #gestational age at birth
>   #<37 weeks = preterm
>   #37-38 weeks = early term
>   #39-40 weeks = full term (baseline)
>   #>=41 weeks = late/post term
> 
>   #maternal BMI
>   #<18.5 = underweight
>   #>=18.5 and <25 = normal weight (baseline)
>   #>=25 and <30 = overweight
>   #>=30 = obese
> 
> 
> #Save continious variables as seperate variables to use as adjustment covariates
> d$W_gagebrth <- d$gagebrth
> d$W_birthwt <- d$birthwt
> d$W_birthlen <- d$birthlen
> d$W_mage <- d$mage
> d$W_mhtcm <- d$mhtcm
> d$W_mwtkg <- d$mwtkg
> d$W_mbmi <- d$mbmi
> d$W_fage <- d$fage
> d$W_fhtcm <- d$fhtcm
> d$W_meducyrs <- d$meducyrs
> d$W_feducyrs <- d$feducyrs
> 
> d$W_nrooms <- d$nrooms
> d$W_nhh <- d$nhh
> d$W_nchldlt5 <- d$nchldlt5
> d$W_parity <- d$parity
> 
> 
> 
> 
> #Overall a-priori quantiles
> d$gagebrth <- quantile_rf(d, d$W_gagebrth, Acuts=c(0,260,274,max(d$W_gagebrth, na.rm=T)), labs=c("Preterm", "Early term", "Full or late term"))
                                             
                                              Preterm Early term
  CMC-V-BCS-2002 INDIA                             52         84
  COHORTS GUATEMALA                               134        237
  COHORTS INDIA                                   319        466
  COHORTS PHILIPPINES                             653       1212
  iLiNS-DYAD-M MALAWI                              96        314
  IRC INDIA                                        42         98
  JiVitA-3 BANGLADESH                            5461       7176
  Keneba GAMBIA                                   257        609
  NIH-Crypto BANGLADESH                           265        325
  PROBIT BELARUS                                  591       7677
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF     350        514
                                             
                                              Full or late term
  CMC-V-BCS-2002 INDIA                                      215
  COHORTS GUATEMALA                                         454
  COHORTS INDIA                                             594
  COHORTS PHILIPPINES                                      1167
  iLiNS-DYAD-M MALAWI                                       795
  IRC INDIA                                                 250
  JiVitA-3 BANGLADESH                                     13408
  Keneba GAMBIA                                             847
  NIH-Crypto BANGLADESH                                     168
  PROBIT BELARUS                                           8630
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF              1390

          Preterm        Early term Full or late term 
             8220             18712             27918 
> d$birthwt <- quantile_rf(d, d$W_birthwt, Acuts=c(0,2500,max(d$W_birthwt, na.rm=T)), labs=c("Low birthweight", "Normal or high birthweight"))
                                             
                                              Low birthweight
  CMC-V-BCS-2002 INDIA                                     43
  CMIN BANGLADESH                                          13
  COHORTS GUATEMALA                                        85
  COHORTS INDIA                                          1395
  COHORTS PHILIPPINES                                     295
  CONTENT PERU                                              0
  EE PAKISTAN                                             134
  GMS-Nepal NEPAL                                         231
  iLiNS-DYAD-M MALAWI                                     136
  IRC INDIA                                                69
  JiVitA-3 BANGLADESH                                    9890
  JiVitA-4 BANGLADESH                                    1179
  Keneba GAMBIA                                           222
  MAL-ED BANGLADESH                                        57
  MAL-ED BRAZIL                                            12
  MAL-ED INDIA                                             36
  MAL-ED NEPAL                                             19
  MAL-ED PERU                                              17
  MAL-ED SOUTH AFRICA                                      22
  MAL-ED TANZANIA, UNITED REPUBLIC OF                      10
  NIH-Birth BANGLADESH                                    196
  NIH-Crypto BANGLADESH                                   177
  PROBIT BELARUS                                            0
  PROVIDE BANGLADESH                                      168
  ResPak PAKISTAN                                           8
  SAS-CompFeed INDIA                                     2322
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF              82
  ZVITAMBO ZIMBABWE                                      1934
                                             
                                              Normal or high birthweight
  CMC-V-BCS-2002 INDIA                                               322
  CMIN BANGLADESH                                                     13
  COHORTS GUATEMALA                                                  859
  COHORTS INDIA                                                     5385
  COHORTS PHILIPPINES                                               2716
  CONTENT PERU                                                         2
  EE PAKISTAN                                                        245
  GMS-Nepal NEPAL                                                    466
  iLiNS-DYAD-M MALAWI                                                894
  IRC INDIA                                                          335
  JiVitA-3 BANGLADESH                                              13009
  JiVitA-4 BANGLADESH                                               3329
  Keneba GAMBIA                                                     1316
  MAL-ED BANGLADESH                                                  205
  MAL-ED BRAZIL                                                      221
  MAL-ED INDIA                                                       205
  MAL-ED NEPAL                                                       214
  MAL-ED PERU                                                        282
  MAL-ED SOUTH AFRICA                                                290
  MAL-ED TANZANIA, UNITED REPUBLIC OF                                187
  NIH-Birth BANGLADESH                                               412
  NIH-Crypto BANGLADESH                                              581
  PROBIT BELARUS                                                   16898
  PROVIDE BANGLADESH                                                 532
  ResPak PAKISTAN                                                     34
  SAS-CompFeed INDIA                                                7159
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF                       2289
  ZVITAMBO ZIMBABWE                                                12107

           Low birthweight Normal or high birthweight 
                     18752                      70507 
> d$birthlen <- quantile_rf(d, d$W_birthlen, Acuts=c(0,48, 50, max(d$W_birthlen, na.rm=T)), units="cm")
                                     
                                      <48 cm [48-50) cm >=50 cm
  CMC-V-BCS-2002 INDIA                    50         40      16
  CMIN BANGLADESH                         19          5       2
  COHORTS GUATEMALA                      163        252     437
  COHORTS INDIA                         2779       2440    1426
  COHORTS PHILIPPINES                    762       1159    1129
  CONTENT PERU                             1          0       1
  EE PAKISTAN                            174         46      22
  GMS-Nepal NEPAL                        385        208     104
  iLiNS-DYAD-M MALAWI                     10          8       5
  IRC INDIA                              111        138     142
  JiVitA-3 BANGLADESH                  16235       5091    1229
  JiVitA-4 BANGLADESH                   2174       1077    1232
  Keneba GAMBIA                          293        495     764
  MAL-ED BANGLADESH                      117         79      35
  MAL-ED BRAZIL                           18         24      23
  MAL-ED INDIA                            22         16       9
  MAL-ED NEPAL                            12          8       7
  MAL-ED PERU                             92        100      41
  MAL-ED SOUTH AFRICA                     36         52      35
  MAL-ED TANZANIA, UNITED REPUBLIC OF     44         61      20
  NIH-Birth BANGLADESH                   253        231     124
  NIH-Crypto BANGLADESH                  292        298     168
  PROBIT BELARUS                         191       1395   15312
  PROVIDE BANGLADESH                     248        283     169
  ResPak PAKISTAN                         19         13      10
  SAS-CompFeed INDIA                    5050       3004    1406
  ZVITAMBO ZIMBABWE                     4482       5341    4126

    <48 cm [48-50) cm    >=50 cm 
     34032      21864      27994 
> 
> # Fix Ages in Burkino Faso Zinc so they are categorized correctly by the function, which are based on these categories:
> #Categories: <20 years old; 20-29 years old; 30-39 years old; 40-49 years old; 50+ years old
> d$W_mage[d$studyid=="Burkina Faso Zn" & d$W_mage==20] <- 18
> d$mage <- quantile_rf(d, d$W_mage, Acuts=c(0,20,30,max(d$W_mage, na.rm=T)))
                                             
                                                <20 [20-30)  >=30
  Burkina Faso Zn BURKINA FASO                  848    3066  2327
  CMC-V-BCS-2002 INDIA                           34     296    43
  COHORTS GUATEMALA                             300     984   717
  COHORTS INDIA                                 436    3646  1292
  COHORTS PHILIPPINES                           378    1827   853
  EE PAKISTAN                                     1     162   214
  GMS-Nepal NEPAL                               149     447   102
  Guatemala BSC GUATEMALA                        47     175    59
  iLiNS-DOSE MALAWI                             301    1079   469
  iLiNS-DYAD-M MALAWI                           283     671   251
  iLiNS-Zinc BURKINA FASO                       403    1743  1033
  IRC INDIA                                      37     344    29
  JiVitA-3 BANGLADESH                         12257   12751  2344
  Keneba GAMBIA                                 399    1455  1042
  LCNI-5 MALAWI                                 108     364   198
  MAL-ED BANGLADESH                              37     182    46
  MAL-ED BRAZIL                                  43     139    51
  MAL-ED INDIA                                   34     194    21
  MAL-ED NEPAL                                    5     189    46
  MAL-ED PERU                                    83     153    67
  MAL-ED SOUTH AFRICA                            48     161   105
  MAL-ED TANZANIA, UNITED REPUBLIC OF            16     140   106
  NIH-Birth BANGLADESH                           73     422   132
  NIH-Crypto BANGLADESH                         136     494   128
  PROBIT BELARUS                               1745   12130  3023
  PROVIDE BANGLADESH                             85     493   122
  SAS-CompFeed INDIA                           1227    7274  1038
  SAS-FoodSuppl INDIA                            36     290    92
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF   167    1571   638
  VITAMIN-A INDIA                               247    3146   512
  ZVITAMBO ZIMBABWE                            2243    9447  2357

    <20 [20-30)    >=30 
  22206   65435   19457 
> 
> d$mhtcm <- quantile_rf(d, d$W_mhtcm, Acuts=c(0,151,155,max(d$W_mhtcm, na.rm=T)), units="cm")
                                             
                                              <151 cm [151-155) cm >=155 cm
  Burkina Faso Zn BURKINA FASO                    327          800     5033
  COHORTS GUATEMALA                              1108          353      221
  COHORTS INDIA                                   829          516      581
  COHORTS PHILIPPINES                            1549          877      632
  Guatemala BSC GUATEMALA                         143           56       36
  iLiNS-DOSE MALAWI                               398          470     1060
  iLiNS-DYAD-M MALAWI                             203          326      670
  iLiNS-Zinc BURKINA FASO                          91          226     2900
  JiVitA-3 BANGLADESH                           16190         6882     4166
  Keneba GAMBIA                                    94          328     2035
  LCNI-5 MALAWI                                   131          192      514
  MAL-ED BANGLADESH                               163           66       25
  MAL-ED BRAZIL                                    53           39      130
  MAL-ED INDIA                                    115           72       55
  MAL-ED NEPAL                                    133           64       41
  MAL-ED PERU                                     169           61       60
  MAL-ED SOUTH AFRICA                              33           33      204
  MAL-ED TANZANIA, UNITED REPUBLIC OF              51           52      153
  NIH-Birth BANGLADESH                            366          146      117
  NIH-Crypto BANGLADESH                           435          180      140
  PROBIT BELARUS                                  125          398    13211
  PROVIDE BANGLADESH                              373          158      138
  SAS-CompFeed INDIA                             3005         2091     3683
  SAS-FoodSuppl INDIA                             220          111       78
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF     358          511     1490
  ZVITAMBO ZIMBABWE                               574         1439     7839

     <151 cm [151-155) cm     >=155 cm 
       27236        16447        45212 
> d$mwtkg <- quantile_rf(d, d$W_mwtkg, Acuts=c(0,52,58,max(d$W_mwtkg, na.rm=T)), units="kg")
                                             
                                              <52 kg [52-58) kg >=58 kg
  Burkina Faso Zn BURKINA FASO                  2344       1925    1673
  iLiNS-DOSE MALAWI                              938        567     419
  iLiNS-DYAD-M MALAWI                            543        369     288
  iLiNS-Zinc BURKINA FASO                       1201       1079     937
  JiVitA-3 BANGLADESH                          24878       1780     674
  LCNI-5 MALAWI                                  504        220     114
  MAL-ED BANGLADESH                              162         44      48
  MAL-ED BRAZIL                                   42         36     143
  MAL-ED INDIA                                   150         50      42
  MAL-ED NEPAL                                    76         82      80
  MAL-ED PERU                                    115         71     104
  MAL-ED SOUTH AFRICA                             30         46     194
  MAL-ED TANZANIA, UNITED REPUBLIC OF             99         59      98
  NIH-Birth BANGLADESH                           453         94      82
  NIH-Crypto BANGLADESH                          406        157     192
  PROBIT BELARUS                                1131       2362   10279
  PROVIDE BANGLADESH                             432        117     120
  SAS-CompFeed INDIA                            7248       1518     723
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF    393        483    1476
  ZVITAMBO ZIMBABWE                             2408       2953    5843

    <52 kg [52-58) kg    >=58 kg 
     43553      14012      23529 
> d$mbmi <- quantile_rf(d, d$W_mbmi, Acuts=c(0,18.5,max(d$W_mbmi, na.rm=T)), labs=c("Underweight", "Normal weight"))
                                             
                                              Underweight Normal weight
  Burkina Faso Zn BURKINA FASO                        602          5340
  iLiNS-DOSE MALAWI                                   136          1785
  iLiNS-DYAD-M MALAWI                                  65          1130
  iLiNS-Zinc BURKINA FASO                             454          2763
  JiVitA-3 BANGLADESH                               10428         16809
  LCNI-5 MALAWI                                       145           692
  MAL-ED BANGLADESH                                    32           222
  MAL-ED BRAZIL                                        10           211
  MAL-ED INDIA                                         49           193
  MAL-ED NEPAL                                          0           238
  MAL-ED PERU                                           5           285
  MAL-ED SOUTH AFRICA                                   8           262
  MAL-ED TANZANIA, UNITED REPUBLIC OF                  14           242
  NIH-Birth BANGLADESH                                106           523
  NIH-Crypto BANGLADESH                                68           687
  PROBIT BELARUS                                      523         13205
  PROVIDE BANGLADESH                                  127           542
  SAS-CompFeed INDIA                                 2344          6435
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF          38          2307
  ZVITAMBO ZIMBABWE                                   517          9302

  Underweight Normal weight 
        15671         63173 
> d$fage <- quantile_rf(d, d$W_fage, Acuts=c(0,32,38,max(d$W_fage, na.rm=T)))
                                     
                                        <32 [32-38)  >=38
  COHORTS GUATEMALA                     904     451   545
  COHORTS PHILIPPINES                  2083     538   330
  iLiNS-DOSE MALAWI                     987     341   384
  iLiNS-DYAD-M MALAWI                   682     249   232
  LCNI-5 MALAWI                          56      24    26
  MAL-ED BANGLADESH                      30      52    69
  MAL-ED BRAZIL                          18      31    30
  MAL-ED INDIA                           53      72    36
  MAL-ED NEPAL                           15      47    17
  MAL-ED PERU                            29      29    27
  MAL-ED SOUTH AFRICA                     9      16    65
  MAL-ED TANZANIA, UNITED REPUBLIC OF    15      37    48
  PROBIT BELARUS                      13059    2475   744
  SAS-CompFeed INDIA                   8013    1196   309
  SAS-FoodSuppl INDIA                   289      85    44

    <32 [32-38)    >=38 
  26242    5643    2906 
> d$fhtcm <- quantile_rf(d, d$W_fhtcm, Acuts=c(0,162,167,max(d$W_fhtcm, na.rm=T)), units="cm")
                     
                      <162 cm [162-167) cm >=167 cm
  COHORTS GUATEMALA       506          226      117
  Keneba GAMBIA           133          557     1258
  PROBIT BELARUS          168          625    11744
  SAS-CompFeed INDIA     1391         1703     2657
  SAS-FoodSuppl INDIA     163          130      106

     <162 cm [162-167) cm     >=167 cm 
        2361         3241        15882 
> 
>  
> 
> 
> #Make education categorizing function that handles the irregular distribution across studies.
> # (As years of education is more country-specific, categorize within studies)
> # Function groups subjects into even categories from irregular distributions of education 
> # (just tertiling leads to sparsity/R errors)
> 
> quantile_rf_edu <- function(d, Avar="meducyrs", to.character=F){
+   dfull <-d
+   
+   print(d$studyid[1])
+   print(d$country[1])
+   
+   A0 <- NULL
+   d <- data.frame(id=1:nrow(dfull), A=as.data.frame(dfull[,Avar])[,1])
+   
+   if(sum(is.na(d$A))!=nrow(d)){
+     
+     Acuts=c(0, as.numeric(quantile(d$A, probs = c(1/3, 2/3), na.rm=T)), max(d$A, na.rm=T))
+     if(length(Acuts)==length(unique(Acuts))){
+       
+       Alevels=c("Low","Medium","High")
+       A1 <- cut(d$A, include.lowest = T, right = T, breaks=Acuts,labels=Alevels)
+       A2 <- cut(d$A, include.lowest = T, right = F, breaks=Acuts,labels=Alevels)
+       rght=F
+       if(min(table(A1)) >= min(table(A2))) rght=T
+       A <- cut(d$A, include.lowest = T, right = rght, breaks=Acuts,labels=Alevels)
+       
+     }else{
+       if(Acuts[2]==Acuts[3] & Acuts[2]!=0){
+         A<-rep(NA, nrow(d))
+         A[d$A < Acuts[2] & !is.na(d$A)] <- "Low"
+         A[d$A == Acuts[2] & !is.na(d$A)] <- "Medium"
+         A[d$A > Acuts[2] & !is.na(d$A)] <- "High"
+         A <- factor(A, levels = c("Low","Medium","High"))
+       }else{
+         
+         if(sum(d$A==0, na.rm=T)>0){
+           A0 <- d[d$A==0,]
+           A0 <- A0[!is.na(A0$A),]
+           A0$A <- "Low"
+         }
+         
+         A <- d[d$A!=0 | is.na(d$A),]
+         Acuts=c(0, as.numeric(quantile(A$A, probs = 0.5, na.rm=T)), max(A$A, na.rm=T))
+         Alevels=c("Medium","High")    
+         A$A <- cut(A$A, include.lowest = T, right = T, breaks=Acuts,labels=Alevels)
+         if(!is.null(A0)){
+           df<-rbind(A,A0)
+         }else{
+           df<-A
+         }
+         
+         df <- df %>% arrange(id)
+         A <- factor(df$A, levels = c("Low","Medium","High"))
+       }
+     }
+     dfull[,Avar] <- A
+     
+   }
+   dfull <-as.data.frame(dfull)
+   if(to.character){
+   dfull[,Avar] <- as.character(dfull[,Avar])
+   }
+   print(class(dfull[,Avar]))
+   return(dfull)
+ }
> 
> d <- d %>% group_by(studyid, country) %>%
+   do(quantile_rf_edu(., Avar="meducyrs"))
[1] "Burkina Faso Zn"
[1] "BURKINA FASO"
[1] "factor"
[1] "CMC-V-BCS-2002"
[1] "INDIA"
[1] "factor"
[1] "CMIN"
[1] "BANGLADESH"
[1] "integer"
[1] "COHORTS"
[1] "GUATEMALA"
[1] "factor"
[1] "COHORTS"
[1] "INDIA"
[1] "factor"
[1] "COHORTS"
[1] "PHILIPPINES"
[1] "factor"
[1] "CONTENT"
[1] "PERU"
[1] "integer"
[1] "EE"
[1] "PAKISTAN"
[1] "factor"
[1] "GMS-Nepal"
[1] "NEPAL"
[1] "factor"
[1] "Guatemala BSC"
[1] "GUATEMALA"
[1] "factor"
[1] "iLiNS-DOSE"
[1] "MALAWI"
[1] "factor"
[1] "iLiNS-DYAD-M"
[1] "MALAWI"
[1] "factor"
[1] "iLiNS-Zinc"
[1] "BURKINA FASO"
[1] "integer"
[1] "IRC"
[1] "INDIA"
[1] "factor"
[1] "JiVitA-3"
[1] "BANGLADESH"
[1] "factor"
[1] "JiVitA-4"
[1] "BANGLADESH"
[1] "factor"
[1] "Keneba"
[1] "GAMBIA"
[1] "integer"
[1] "LCNI-5"
[1] "MALAWI"
[1] "factor"
[1] "MAL-ED"
[1] "BANGLADESH"
[1] "factor"
[1] "MAL-ED"
[1] "BRAZIL"
[1] "factor"
[1] "MAL-ED"
[1] "INDIA"
[1] "factor"
[1] "MAL-ED"
[1] "NEPAL"
[1] "factor"
[1] "MAL-ED"
[1] "PERU"
[1] "factor"
[1] "MAL-ED"
[1] "SOUTH AFRICA"
[1] "factor"
[1] "MAL-ED"
[1] "TANZANIA, UNITED REPUBLIC OF"
[1] "factor"
[1] "NIH-Birth"
[1] "BANGLADESH"
[1] "factor"
[1] "NIH-Crypto"
[1] "BANGLADESH"
[1] "factor"
[1] "PROBIT"
[1] "BELARUS"
[1] "factor"
[1] "PROVIDE"
[1] "BANGLADESH"
[1] "factor"
[1] "ResPak"
[1] "PAKISTAN"
[1] "integer"
[1] "SAS-CompFeed"
[1] "INDIA"
[1] "factor"
[1] "SAS-FoodSuppl"
[1] "INDIA"
[1] "factor"
[1] "TanzaniaChild2"
[1] "TANZANIA, UNITED REPUBLIC OF"
[1] "factor"
[1] "VITAMIN-A"
[1] "INDIA"
[1] "factor"
[1] "ZVITAMBO"
[1] "ZIMBABWE"
[1] "factor"
> #d <- d %>% arrange(feducyrs, studyid, country, subjid)
> d <- d %>% group_by(studyid, country) %>%
+   do(quantile_rf_edu(., Avar="feducyrs", to.character=T))
[1] "Burkina Faso Zn"
[1] "BURKINA FASO"
[1] "character"
[1] "CMC-V-BCS-2002"
[1] "INDIA"
[1] "character"
[1] "CMIN"
[1] "BANGLADESH"
[1] "character"
[1] "COHORTS"
[1] "GUATEMALA"
[1] "character"
[1] "COHORTS"
[1] "INDIA"
[1] "character"
[1] "COHORTS"
[1] "PHILIPPINES"
[1] "character"
[1] "CONTENT"
[1] "PERU"
[1] "character"
[1] "EE"
[1] "PAKISTAN"
[1] "character"
[1] "GMS-Nepal"
[1] "NEPAL"
[1] "character"
[1] "Guatemala BSC"
[1] "GUATEMALA"
[1] "character"
[1] "iLiNS-DOSE"
[1] "MALAWI"
[1] "character"
[1] "iLiNS-DYAD-M"
[1] "MALAWI"
[1] "character"
[1] "iLiNS-Zinc"
[1] "BURKINA FASO"
[1] "character"
[1] "IRC"
[1] "INDIA"
[1] "character"
[1] "JiVitA-3"
[1] "BANGLADESH"
[1] "character"
[1] "JiVitA-4"
[1] "BANGLADESH"
[1] "character"
[1] "Keneba"
[1] "GAMBIA"
[1] "character"
[1] "LCNI-5"
[1] "MALAWI"
[1] "character"
[1] "MAL-ED"
[1] "BANGLADESH"
[1] "character"
[1] "MAL-ED"
[1] "BRAZIL"
[1] "character"
[1] "MAL-ED"
[1] "INDIA"
[1] "character"
[1] "MAL-ED"
[1] "NEPAL"
[1] "character"
[1] "MAL-ED"
[1] "PERU"
[1] "character"
[1] "MAL-ED"
[1] "SOUTH AFRICA"
[1] "character"
[1] "MAL-ED"
[1] "TANZANIA, UNITED REPUBLIC OF"
[1] "character"
[1] "NIH-Birth"
[1] "BANGLADESH"
[1] "character"
[1] "NIH-Crypto"
[1] "BANGLADESH"
[1] "character"
[1] "PROBIT"
[1] "BELARUS"
[1] "character"
[1] "PROVIDE"
[1] "BANGLADESH"
[1] "character"
[1] "ResPak"
[1] "PAKISTAN"
[1] "character"
[1] "SAS-CompFeed"
[1] "INDIA"
[1] "character"
[1] "SAS-FoodSuppl"
[1] "INDIA"
[1] "character"
[1] "TanzaniaChild2"
[1] "TANZANIA, UNITED REPUBLIC OF"
[1] "character"
[1] "VITAMIN-A"
[1] "INDIA"
[1] "character"
[1] "ZVITAMBO"
[1] "ZIMBABWE"
[1] "character"
> d$feducyrs <- factor(d$feducyrs, levels = c("Low","Medium","High"))
> 
> table(d$meducyrs)

   Low Medium   High 
 39713  36495  30485 
> table(d$feducyrs)

   Low Medium   High 
 32630  37781  20562 
> 
> table(paste0(d$studyid," ", d$country), d$meducyrs)
                                             
                                               Low Medium High
  Burkina Faso Zn BURKINA FASO                4823    873  256
  CMC-V-BCS-2002 INDIA                         106    109  158
  CMIN BANGLADESH                                0      0    0
  COHORTS GUATEMALA                            945    603  422
  COHORTS INDIA                               1979   3136  802
  COHORTS PHILIPPINES                          903    982 1173
  CONTENT PERU                                   0      0    0
  EE PAKISTAN                                  329     33   15
  GMS-Nepal NEPAL                              486    124   85
  Guatemala BSC GUATEMALA                       76     88  118
  iLiNS-DOSE MALAWI                            592    565  710
  iLiNS-DYAD-M MALAWI                          407    476  322
  iLiNS-Zinc BURKINA FASO                        0      0    0
  IRC INDIA                                    147    139  124
  JiVitA-3 BANGLADESH                         9927   8340 9059
  JiVitA-4 BANGLADESH                         1787   1733 1901
  Keneba GAMBIA                                  0      0    0
  LCNI-5 MALAWI                                261    255  298
  MAL-ED BANGLADESH                             70     66   78
  MAL-ED BRAZIL                                 63     90   79
  MAL-ED INDIA                                  76     81   63
  MAL-ED NEPAL                                  96     76   53
  MAL-ED PERU                                  104    107   91
  MAL-ED SOUTH AFRICA                          150     69   95
  MAL-ED TANZANIA, UNITED REPUBLIC OF           64    142   11
  NIH-Birth BANGLADESH                         230    220  179
  NIH-Crypto BANGLADESH                        242    262  254
  PROBIT BELARUS                              6100   7957 2841
  PROVIDE BANGLADESH                           214    251  235
  ResPak PAKISTAN                                0      0    0
  SAS-CompFeed INDIA                          4245   3240 2054
  SAS-FoodSuppl INDIA                          332     45   41
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF   82   1683  621
  VITAMIN-A INDIA                             1914   1277  716
  ZVITAMBO ZIMBABWE                           2963   3473 7631
> table(paste0(d$studyid," ", d$country), d$feducyrs)
                                             
                                                Low Medium  High
  Burkina Faso Zn BURKINA FASO                    0      0     0
  CMC-V-BCS-2002 INDIA                            0      0     0
  CMIN BANGLADESH                                 0      0     0
  COHORTS GUATEMALA                             860    625   319
  COHORTS INDIA                                 475    414   569
  COHORTS PHILIPPINES                           828   1021  1031
  CONTENT PERU                                    0      0     0
  EE PAKISTAN                                     0      0     0
  GMS-Nepal NEPAL                               296    227   173
  Guatemala BSC GUATEMALA                         0      0     0
  iLiNS-DOSE MALAWI                             584    525   698
  iLiNS-DYAD-M MALAWI                           433    411   361
  iLiNS-Zinc BURKINA FASO                         0      0     0
  IRC INDIA                                       0      0     0
  JiVitA-3 BANGLADESH                         10854   8981  6525
  JiVitA-4 BANGLADESH                          1955   2076  1247
  Keneba GAMBIA                                   0      0     0
  LCNI-5 MALAWI                                 291    271   251
  MAL-ED BANGLADESH                              40     55    54
  MAL-ED BRAZIL                                   0      0     0
  MAL-ED INDIA                                   59     44    44
  MAL-ED NEPAL                                   28     28    42
  MAL-ED PERU                                    69     61   120
  MAL-ED SOUTH AFRICA                            37     30    43
  MAL-ED TANZANIA, UNITED REPUBLIC OF            61     21   130
  NIH-Birth BANGLADESH                            0      0     0
  NIH-Crypto BANGLADESH                         242    220   296
  PROBIT BELARUS                               6418   7189  2708
  PROVIDE BANGLADESH                            238    230   232
  ResPak PAKISTAN                                 0      0     0
  SAS-CompFeed INDIA                           3967   3059  2492
  SAS-FoodSuppl INDIA                           147    161   110
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF  1270    664   449
  VITAMIN-A INDIA                              1162   1079  1666
  ZVITAMBO ZIMBABWE                            2316  10389  1002
> 
> 
> 
> 
> #Categorize nrooms, nhh, nchild5
> table(d$nrooms)

    1     2     3     4     5     6     7     8     9    10    11    12    13 
27594 13154  4974  1973   725   345   145    81    38    32     7     8     3 
   14    15    77 
    4     6     2 
> table(paste0(d$studyid," ", d$country), d$nrooms)
                                             
                                                  1     2     3     4     5
  Burkina Faso Zn BURKINA FASO                    0     0     0     0     0
  CMC-V-BCS-2002 INDIA                          202   106    51    12     1
  CMIN BANGLADESH                                 0     0     0     0     0
  COHORTS GUATEMALA                               0     0     0     0     0
  COHORTS INDIA                                3563  1567   199    83    17
  COHORTS PHILIPPINES                             0     0     0     0     0
  CONTENT PERU                                   44    54    39    35    26
  EE PAKISTAN                                     0     0     0     0     0
  GMS-Nepal NEPAL                                49   145   181   165    67
  Guatemala BSC GUATEMALA                         0     0     0     0     0
  iLiNS-DOSE MALAWI                             340   701   446   209    35
  iLiNS-DYAD-M MALAWI                           136   141    65    27    10
  iLiNS-Zinc BURKINA FASO                         0     0     0     0     0
  IRC INDIA                                     185   170    36    12     2
  JiVitA-3 BANGLADESH                         16201  7360  2629   773   251
  JiVitA-4 BANGLADESH                          3193  1387   562   185    60
  Keneba GAMBIA                                   0     0     0     0     0
  LCNI-5 MALAWI                                   0     0     0     0     0
  MAL-ED BANGLADESH                             152    50    28     9     1
  MAL-ED BRAZIL                                   4    20    59    58    36
  MAL-ED INDIA                                   84    78    48    21     2
  MAL-ED NEPAL                                   52    31    22    31    26
  MAL-ED PERU                                    19    52    62    57    43
  MAL-ED SOUTH AFRICA                            14    22    25    39    43
  MAL-ED TANZANIA, UNITED REPUBLIC OF            13    63    66    35    30
  NIH-Birth BANGLADESH                            0     0     0     0     0
  NIH-Crypto BANGLADESH                         368   191   104    57    25
  PROBIT BELARUS                                  0     0     0     0     0
  PROVIDE BANGLADESH                            507   108    62    13     6
  ResPak PAKISTAN                                 0     0     0     0     0
  SAS-CompFeed INDIA                              0     0     0     0     0
  SAS-FoodSuppl INDIA                             0     0     0     0     0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF     0     0     0     0     0
  VITAMIN-A INDIA                              2468   908   290   152    44
  ZVITAMBO ZIMBABWE                               0     0     0     0     0
                                             
                                                  6     7     8     9    10
  Burkina Faso Zn BURKINA FASO                    0     0     0     0     0
  CMC-V-BCS-2002 INDIA                            1     0     0     0     0
  CMIN BANGLADESH                                 0     0     0     0     0
  COHORTS GUATEMALA                               0     0     0     0     0
  COHORTS INDIA                                   6     0     0     0     0
  COHORTS PHILIPPINES                             0     0     0     0     0
  CONTENT PERU                                    7     7     1     1     0
  EE PAKISTAN                                     0     0     0     0     0
  GMS-Nepal NEPAL                                52    17    12     2     5
  Guatemala BSC GUATEMALA                         0     0     0     0     0
  iLiNS-DOSE MALAWI                              13     3     3     0     0
  iLiNS-DYAD-M MALAWI                             0     0     0     3     0
  iLiNS-Zinc BURKINA FASO                         0     0     0     0     0
  IRC INDIA                                       1     2     0     0     0
  JiVitA-3 BANGLADESH                            85    21     9     0     1
  JiVitA-4 BANGLADESH                            23    10     6     0     1
  Keneba GAMBIA                                   0     0     0     0     0
  LCNI-5 MALAWI                                   0     0     0     0     0
  MAL-ED BANGLADESH                               2     0     0     0     0
  MAL-ED BRAZIL                                  17     9     3     2     1
  MAL-ED INDIA                                    2     0     0     0     0
  MAL-ED NEPAL                                   19    17    15     4     9
  MAL-ED PERU                                    23    12     3     0     1
  MAL-ED SOUTH AFRICA                            36    33    13    15     7
  MAL-ED TANZANIA, UNITED REPUBLIC OF            17    11     6     5     2
  NIH-Birth BANGLADESH                            0     0     0     0     0
  NIH-Crypto BANGLADESH                           7     1     2     2     1
  PROBIT BELARUS                                  0     0     0     0     0
  PROVIDE BANGLADESH                              2     1     0     1     0
  ResPak PAKISTAN                                 0     0     0     0     0
  SAS-CompFeed INDIA                              0     0     0     0     0
  SAS-FoodSuppl INDIA                             0     0     0     0     0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF     0     0     0     0     0
  VITAMIN-A INDIA                                32     1     8     3     4
  ZVITAMBO ZIMBABWE                               0     0     0     0     0
                                             
                                                 11    12    13    14    15
  Burkina Faso Zn BURKINA FASO                    0     0     0     0     0
  CMC-V-BCS-2002 INDIA                            0     0     0     0     0
  CMIN BANGLADESH                                 0     0     0     0     0
  COHORTS GUATEMALA                               0     0     0     0     0
  COHORTS INDIA                                   0     0     0     0     0
  COHORTS PHILIPPINES                             0     0     0     0     0
  CONTENT PERU                                    1     0     0     0     0
  EE PAKISTAN                                     0     0     0     0     0
  GMS-Nepal NEPAL                                 1     0     0     1     1
  Guatemala BSC GUATEMALA                         0     0     0     0     0
  iLiNS-DOSE MALAWI                               0     0     0     0     0
  iLiNS-DYAD-M MALAWI                             0     0     0     0     0
  iLiNS-Zinc BURKINA FASO                         0     0     0     0     0
  IRC INDIA                                       0     0     0     0     0
  JiVitA-3 BANGLADESH                             0     0     0     0     0
  JiVitA-4 BANGLADESH                             0     0     1     0     0
  Keneba GAMBIA                                   0     0     0     0     0
  LCNI-5 MALAWI                                   0     0     0     0     0
  MAL-ED BANGLADESH                               0     0     0     0     0
  MAL-ED BRAZIL                                   0     0     0     1     0
  MAL-ED INDIA                                    0     0     0     0     0
  MAL-ED NEPAL                                    2     5     0     1     2
  MAL-ED PERU                                     0     0     0     0     0
  MAL-ED SOUTH AFRICA                             2     2     2     1     3
  MAL-ED TANZANIA, UNITED REPUBLIC OF             1     1     0     0     0
  NIH-Birth BANGLADESH                            0     0     0     0     0
  NIH-Crypto BANGLADESH                           0     0     0     0     0
  PROBIT BELARUS                                  0     0     0     0     0
  PROVIDE BANGLADESH                              0     0     0     0     0
  ResPak PAKISTAN                                 0     0     0     0     0
  SAS-CompFeed INDIA                              0     0     0     0     0
  SAS-FoodSuppl INDIA                             0     0     0     0     0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF     0     0     0     0     0
  VITAMIN-A INDIA                                 0     0     0     0     0
  ZVITAMBO ZIMBABWE                               0     0     0     0     0
                                             
                                                 77
  Burkina Faso Zn BURKINA FASO                    0
  CMC-V-BCS-2002 INDIA                            0
  CMIN BANGLADESH                                 0
  COHORTS GUATEMALA                               0
  COHORTS INDIA                                   0
  COHORTS PHILIPPINES                             0
  CONTENT PERU                                    0
  EE PAKISTAN                                     0
  GMS-Nepal NEPAL                                 0
  Guatemala BSC GUATEMALA                         0
  iLiNS-DOSE MALAWI                               2
  iLiNS-DYAD-M MALAWI                             0
  iLiNS-Zinc BURKINA FASO                         0
  IRC INDIA                                       0
  JiVitA-3 BANGLADESH                             0
  JiVitA-4 BANGLADESH                             0
  Keneba GAMBIA                                   0
  LCNI-5 MALAWI                                   0
  MAL-ED BANGLADESH                               0
  MAL-ED BRAZIL                                   0
  MAL-ED INDIA                                    0
  MAL-ED NEPAL                                    0
  MAL-ED PERU                                     0
  MAL-ED SOUTH AFRICA                             0
  MAL-ED TANZANIA, UNITED REPUBLIC OF             0
  NIH-Birth BANGLADESH                            0
  NIH-Crypto BANGLADESH                           0
  PROBIT BELARUS                                  0
  PROVIDE BANGLADESH                              0
  ResPak PAKISTAN                                 0
  SAS-CompFeed INDIA                              0
  SAS-FoodSuppl INDIA                             0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF     0
  VITAMIN-A INDIA                                 0
  ZVITAMBO ZIMBABWE                               0
> nroom<-NA
> nroom[d$nrooms<2] <- "1"
> nroom[d$nrooms==2] <- "2"
> nroom[d$nrooms==3] <- "3"
> nroom[d$nrooms>3] <- "4+"
> d$nrooms <- as.factor(nroom)
> table(d$nrooms)

    1     2     3    4+ 
27594 13154  4974  3369 
> table(paste0(d$studyid," ", d$country), d$nrooms)
                                             
                                                  1     2     3    4+
  Burkina Faso Zn BURKINA FASO                    0     0     0     0
  CMC-V-BCS-2002 INDIA                          202   106    51    14
  CMIN BANGLADESH                                 0     0     0     0
  COHORTS GUATEMALA                               0     0     0     0
  COHORTS INDIA                                3563  1567   199   106
  COHORTS PHILIPPINES                             0     0     0     0
  CONTENT PERU                                   44    54    39    78
  EE PAKISTAN                                     0     0     0     0
  GMS-Nepal NEPAL                                49   145   181   323
  Guatemala BSC GUATEMALA                         0     0     0     0
  iLiNS-DOSE MALAWI                             340   701   446   265
  iLiNS-DYAD-M MALAWI                           136   141    65    40
  iLiNS-Zinc BURKINA FASO                         0     0     0     0
  IRC INDIA                                     185   170    36    17
  JiVitA-3 BANGLADESH                         16201  7360  2629  1140
  JiVitA-4 BANGLADESH                          3193  1387   562   286
  Keneba GAMBIA                                   0     0     0     0
  LCNI-5 MALAWI                                   0     0     0     0
  MAL-ED BANGLADESH                             152    50    28    12
  MAL-ED BRAZIL                                   4    20    59   127
  MAL-ED INDIA                                   84    78    48    25
  MAL-ED NEPAL                                   52    31    22   131
  MAL-ED PERU                                    19    52    62   139
  MAL-ED SOUTH AFRICA                            14    22    25   196
  MAL-ED TANZANIA, UNITED REPUBLIC OF            13    63    66   108
  NIH-Birth BANGLADESH                            0     0     0     0
  NIH-Crypto BANGLADESH                         368   191   104    95
  PROBIT BELARUS                                  0     0     0     0
  PROVIDE BANGLADESH                            507   108    62    23
  ResPak PAKISTAN                                 0     0     0     0
  SAS-CompFeed INDIA                              0     0     0     0
  SAS-FoodSuppl INDIA                             0     0     0     0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF     0     0     0     0
  VITAMIN-A INDIA                              2468   908   290   244
  ZVITAMBO ZIMBABWE                               0     0     0     0
> 
> 
> table(d$nhh)  

  1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  20 
  7  95 697 884 813 563 386 220 123 105  47  37  14  12   7   4   5   2   1 
> table(paste0(d$studyid," ", d$country), d$nhh)
                                             
                                                1   2   3   4   5   6   7   8
  Burkina Faso Zn BURKINA FASO                  0   0   0   0   0   0   0   0
  CMC-V-BCS-2002 INDIA                          0   0   0   0   0   0   0   0
  CMIN BANGLADESH                               0   0   0   0   0   0   0   0
  COHORTS GUATEMALA                             0   0   0   0   0   0   0   0
  COHORTS INDIA                                 0   0   0   0   0   0   0   0
  COHORTS PHILIPPINES                           0   0   0   0   0   0   0   0
  CONTENT PERU                                  0   0   0   0   0   0   0   0
  EE PAKISTAN                                   0   0   0   0   0   0   0   0
  GMS-Nepal NEPAL                               0   0   0   0   0   0   0   0
  Guatemala BSC GUATEMALA                       0   0   0   0   0   0   0   0
  iLiNS-DOSE MALAWI                             0   0   0   0   0   0   0   0
  iLiNS-DYAD-M MALAWI                           4  51  52  47  41  34  28  15
  iLiNS-Zinc BURKINA FASO                       0   0   0   0   0   0   0   0
  IRC INDIA                                     1  11  46  80  78  64  43  29
  JiVitA-3 BANGLADESH                           0   0   0   0   0   0   0   0
  JiVitA-4 BANGLADESH                           0   0   0   0   0   0   0   0
  Keneba GAMBIA                                 0   0   0   0   0   0   0   0
  LCNI-5 MALAWI                                 2  28 195 180 160 111  71  40
  MAL-ED BANGLADESH                             0   0   0   0   0   0   0   0
  MAL-ED BRAZIL                                 0   0   0   0   0   0   0   0
  MAL-ED INDIA                                  0   0   0   0   0   0   0   0
  MAL-ED NEPAL                                  0   0   0   0   0   0   0   0
  MAL-ED PERU                                   0   0   0   0   0   0   0   0
  MAL-ED SOUTH AFRICA                           0   0   0   0   0   0   0   0
  MAL-ED TANZANIA, UNITED REPUBLIC OF           0   0   0   0   0   0   0   0
  NIH-Birth BANGLADESH                          0   1 116 130 134  83  59  51
  NIH-Crypto BANGLADESH                         0   2 112 176 166 110  68  29
  PROBIT BELARUS                                0   0   0   0   0   0   0   0
  PROVIDE BANGLADESH                            0   2 138 198 124  84  67  26
  ResPak PAKISTAN                               0   0   0   0   0   0   0   0
  SAS-CompFeed INDIA                            0   0   0   0   0   0   0   0
  SAS-FoodSuppl INDIA                           0   0  38  73 110  77  50  30
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF   0   0   0   0   0   0   0   0
  VITAMIN-A INDIA                               0   0   0   0   0   0   0   0
  ZVITAMBO ZIMBABWE                             0   0   0   0   0   0   0   0
                                             
                                                9  10  11  12  13  14  15  16
  Burkina Faso Zn BURKINA FASO                  0   0   0   0   0   0   0   0
  CMC-V-BCS-2002 INDIA                          0   0   0   0   0   0   0   0
  CMIN BANGLADESH                               0   0   0   0   0   0   0   0
  COHORTS GUATEMALA                             0   0   0   0   0   0   0   0
  COHORTS INDIA                                 0   0   0   0   0   0   0   0
  COHORTS PHILIPPINES                           0   0   0   0   0   0   0   0
  CONTENT PERU                                  0   0   0   0   0   0   0   0
  EE PAKISTAN                                   0   0   0   0   0   0   0   0
  GMS-Nepal NEPAL                               0   0   0   0   0   0   0   0
  Guatemala BSC GUATEMALA                       0   0   0   0   0   0   0   0
  iLiNS-DOSE MALAWI                             0   0   0   0   0   0   0   0
  iLiNS-DYAD-M MALAWI                           4   6   5   2   1   0   0   0
  iLiNS-Zinc BURKINA FASO                       0   0   0   0   0   0   0   0
  IRC INDIA                                    17  12  10   7   6   0   2   1
  JiVitA-3 BANGLADESH                           0   0   0   0   0   0   0   0
  JiVitA-4 BANGLADESH                           0   0   0   0   0   0   0   0
  Keneba GAMBIA                                 0   0   0   0   0   0   0   0
  LCNI-5 MALAWI                                16   9   1   2   2   0   0   0
  MAL-ED BANGLADESH                             0   0   0   0   0   0   0   0
  MAL-ED BRAZIL                                 0   0   0   0   0   0   0   0
  MAL-ED INDIA                                  0   0   0   0   0   0   0   0
  MAL-ED NEPAL                                  0   0   0   0   0   0   0   0
  MAL-ED PERU                                   0   0   0   0   0   0   0   0
  MAL-ED SOUTH AFRICA                           0   0   0   0   0   0   0   0
  MAL-ED TANZANIA, UNITED REPUBLIC OF           0   0   0   0   0   0   0   0
  NIH-Birth BANGLADESH                         21  15   7   3   3   3   0   2
  NIH-Crypto BANGLADESH                        29  28   9  18   1   6   3   0
  PROBIT BELARUS                                0   0   0   0   0   0   0   0
  PROVIDE BANGLADESH                           21  17  12   4   0   2   2   1
  ResPak PAKISTAN                               0   0   0   0   0   0   0   0
  SAS-CompFeed INDIA                            0   0   0   0   0   0   0   0
  SAS-FoodSuppl INDIA                          15  18   3   1   1   1   0   0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF   0   0   0   0   0   0   0   0
  VITAMIN-A INDIA                               0   0   0   0   0   0   0   0
  ZVITAMBO ZIMBABWE                             0   0   0   0   0   0   0   0
                                             
                                               17  18  20
  Burkina Faso Zn BURKINA FASO                  0   0   0
  CMC-V-BCS-2002 INDIA                          0   0   0
  CMIN BANGLADESH                               0   0   0
  COHORTS GUATEMALA                             0   0   0
  COHORTS INDIA                                 0   0   0
  COHORTS PHILIPPINES                           0   0   0
  CONTENT PERU                                  0   0   0
  EE PAKISTAN                                   0   0   0
  GMS-Nepal NEPAL                               0   0   0
  Guatemala BSC GUATEMALA                       0   0   0
  iLiNS-DOSE MALAWI                             0   0   0
  iLiNS-DYAD-M MALAWI                           0   0   0
  iLiNS-Zinc BURKINA FASO                       0   0   0
  IRC INDIA                                     2   0   1
  JiVitA-3 BANGLADESH                           0   0   0
  JiVitA-4 BANGLADESH                           0   0   0
  Keneba GAMBIA                                 0   0   0
  LCNI-5 MALAWI                                 0   0   0
  MAL-ED BANGLADESH                             0   0   0
  MAL-ED BRAZIL                                 0   0   0
  MAL-ED INDIA                                  0   0   0
  MAL-ED NEPAL                                  0   0   0
  MAL-ED PERU                                   0   0   0
  MAL-ED SOUTH AFRICA                           0   0   0
  MAL-ED TANZANIA, UNITED REPUBLIC OF           0   0   0
  NIH-Birth BANGLADESH                          0   1   0
  NIH-Crypto BANGLADESH                         1   0   0
  PROBIT BELARUS                                0   0   0
  PROVIDE BANGLADESH                            1   1   0
  ResPak PAKISTAN                               0   0   0
  SAS-CompFeed INDIA                            0   0   0
  SAS-FoodSuppl INDIA                           1   0   0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF   0   0   0
  VITAMIN-A INDIA                               0   0   0
  ZVITAMBO ZIMBABWE                             0   0   0
> 
> nhh<-NA
> nhh[d$nhh<4] <- "3 or less"
> nhh[d$nhh>3 & d$nhh<6] <- "4-5"
> nhh[d$nhh>5 & d$nhh<8] <- "6-7"
> nhh[d$nhh>7] <- "8+"
> d$nhh <- as.factor(nhh)
> table(d$nhh)

3 or less       4-5       6-7        8+ 
      799      1697       949       577 
> table(paste0(d$studyid," ", d$country), d$nhh)
                                             
                                              3 or less 4-5 6-7  8+
  Burkina Faso Zn BURKINA FASO                        0   0   0   0
  CMC-V-BCS-2002 INDIA                                0   0   0   0
  CMIN BANGLADESH                                     0   0   0   0
  COHORTS GUATEMALA                                   0   0   0   0
  COHORTS INDIA                                       0   0   0   0
  COHORTS PHILIPPINES                                 0   0   0   0
  CONTENT PERU                                        0   0   0   0
  EE PAKISTAN                                         0   0   0   0
  GMS-Nepal NEPAL                                     0   0   0   0
  Guatemala BSC GUATEMALA                             0   0   0   0
  iLiNS-DOSE MALAWI                                   0   0   0   0
  iLiNS-DYAD-M MALAWI                               107  88  62  33
  iLiNS-Zinc BURKINA FASO                             0   0   0   0
  IRC INDIA                                          58 158 107  87
  JiVitA-3 BANGLADESH                                 0   0   0   0
  JiVitA-4 BANGLADESH                                 0   0   0   0
  Keneba GAMBIA                                       0   0   0   0
  LCNI-5 MALAWI                                     225 340 182  70
  MAL-ED BANGLADESH                                   0   0   0   0
  MAL-ED BRAZIL                                       0   0   0   0
  MAL-ED INDIA                                        0   0   0   0
  MAL-ED NEPAL                                        0   0   0   0
  MAL-ED PERU                                         0   0   0   0
  MAL-ED SOUTH AFRICA                                 0   0   0   0
  MAL-ED TANZANIA, UNITED REPUBLIC OF                 0   0   0   0
  NIH-Birth BANGLADESH                              117 264 142 106
  NIH-Crypto BANGLADESH                             114 342 178 124
  PROBIT BELARUS                                      0   0   0   0
  PROVIDE BANGLADESH                                140 322 151  87
  ResPak PAKISTAN                                     0   0   0   0
  SAS-CompFeed INDIA                                  0   0   0   0
  SAS-FoodSuppl INDIA                                38 183 127  70
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF         0   0   0   0
  VITAMIN-A INDIA                                     0   0   0   0
  ZVITAMBO ZIMBABWE                                   0   0   0   0
> 
> 
> table(d$nchldlt5)

    1     2     3     4     5     6     7     8    10    11 
22662 12964  1512   383   107    30    11     3     3     2 
> table(paste0(d$studyid," ", d$country), d$nchldlt5)
                                             
                                                  1     2     3     4     5
  Burkina Faso Zn BURKINA FASO                    0     0     0     0     0
  CMC-V-BCS-2002 INDIA                            0     0     0     0     0
  CMIN BANGLADESH                                 0     0     0     0     0
  COHORTS GUATEMALA                               0     0     0     0     0
  COHORTS INDIA                                   0     0     0     0     0
  COHORTS PHILIPPINES                             0     0     0     0     0
  CONTENT PERU                                    0     0     0     0     0
  EE PAKISTAN                                     0     0     0     0     0
  GMS-Nepal NEPAL                                 0     0     0     0     0
  Guatemala BSC GUATEMALA                         0     0     0     0     0
  iLiNS-DOSE MALAWI                             845   816   119    24     5
  iLiNS-DYAD-M MALAWI                            63   163    40     7     4
  iLiNS-Zinc BURKINA FASO                      1073  1272   525   231    68
  IRC INDIA                                      89   119   100    62    22
  JiVitA-3 BANGLADESH                         17511  9180   596    41     4
  JiVitA-4 BANGLADESH                             0     0     0     0     0
  Keneba GAMBIA                                   0     0     0     0     0
  LCNI-5 MALAWI                                 391   358    51     9     1
  MAL-ED BANGLADESH                               0     0     0     0     0
  MAL-ED BRAZIL                                   0     0     0     0     0
  MAL-ED INDIA                                    0     0     0     0     0
  MAL-ED NEPAL                                    0     0     0     0     0
  MAL-ED PERU                                     0     0     0     0     0
  MAL-ED SOUTH AFRICA                             0     0     0     0     0
  MAL-ED TANZANIA, UNITED REPUBLIC OF             0     0     0     0     0
  NIH-Birth BANGLADESH                            0     0     0     0     0
  NIH-Crypto BANGLADESH                         541   211     6     0     0
  PROBIT BELARUS                                  0     0     0     0     0
  PROVIDE BANGLADESH                            512   176    12     0     0
  ResPak PAKISTAN                                 0     0     0     0     0
  SAS-CompFeed INDIA                              0     0     0     0     0
  SAS-FoodSuppl INDIA                             0     0     0     0     0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF  1637   669    63     9     3
  VITAMIN-A INDIA                                 0     0     0     0     0
  ZVITAMBO ZIMBABWE                               0     0     0     0     0
                                             
                                                  6     7     8    10    11
  Burkina Faso Zn BURKINA FASO                    0     0     0     0     0
  CMC-V-BCS-2002 INDIA                            0     0     0     0     0
  CMIN BANGLADESH                                 0     0     0     0     0
  COHORTS GUATEMALA                               0     0     0     0     0
  COHORTS INDIA                                   0     0     0     0     0
  COHORTS PHILIPPINES                             0     0     0     0     0
  CONTENT PERU                                    0     0     0     0     0
  EE PAKISTAN                                     0     0     0     0     0
  GMS-Nepal NEPAL                                 0     0     0     0     0
  Guatemala BSC GUATEMALA                         0     0     0     0     0
  iLiNS-DOSE MALAWI                               2     0     0     0     0
  iLiNS-DYAD-M MALAWI                             0     1     0     0     1
  iLiNS-Zinc BURKINA FASO                        15     4     1     0     0
  IRC INDIA                                      12     4     2     0     0
  JiVitA-3 BANGLADESH                             1     0     0     0     0
  JiVitA-4 BANGLADESH                             0     0     0     0     0
  Keneba GAMBIA                                   0     0     0     0     0
  LCNI-5 MALAWI                                   0     1     0     0     1
  MAL-ED BANGLADESH                               0     0     0     0     0
  MAL-ED BRAZIL                                   0     0     0     0     0
  MAL-ED INDIA                                    0     0     0     0     0
  MAL-ED NEPAL                                    0     0     0     0     0
  MAL-ED PERU                                     0     0     0     0     0
  MAL-ED SOUTH AFRICA                             0     0     0     0     0
  MAL-ED TANZANIA, UNITED REPUBLIC OF             0     0     0     0     0
  NIH-Birth BANGLADESH                            0     0     0     0     0
  NIH-Crypto BANGLADESH                           0     0     0     0     0
  PROBIT BELARUS                                  0     0     0     0     0
  PROVIDE BANGLADESH                              0     0     0     0     0
  ResPak PAKISTAN                                 0     0     0     0     0
  SAS-CompFeed INDIA                              0     0     0     0     0
  SAS-FoodSuppl INDIA                             0     0     0     0     0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF     0     1     0     3     0
  VITAMIN-A INDIA                                 0     0     0     0     0
  ZVITAMBO ZIMBABWE                               0     0     0     0     0
> 
> nchild5<-NA
> nchild5[d$nchldlt5==1] <- "1"
> nchild5[d$nchldlt5>=2] <- "2+"
> d$nchldlt5 <- as.factor(nchild5)
> table(d$nchldlt5)

    1    2+ 
22662 15015 
> table(paste0(d$studyid," ", d$country), d$nchldlt5)
                                             
                                                  1    2+
  Burkina Faso Zn BURKINA FASO                    0     0
  CMC-V-BCS-2002 INDIA                            0     0
  CMIN BANGLADESH                                 0     0
  COHORTS GUATEMALA                               0     0
  COHORTS INDIA                                   0     0
  COHORTS PHILIPPINES                             0     0
  CONTENT PERU                                    0     0
  EE PAKISTAN                                     0     0
  GMS-Nepal NEPAL                                 0     0
  Guatemala BSC GUATEMALA                         0     0
  iLiNS-DOSE MALAWI                             845   966
  iLiNS-DYAD-M MALAWI                            63   216
  iLiNS-Zinc BURKINA FASO                      1073  2116
  IRC INDIA                                      89   321
  JiVitA-3 BANGLADESH                         17511  9822
  JiVitA-4 BANGLADESH                             0     0
  Keneba GAMBIA                                   0     0
  LCNI-5 MALAWI                                 391   421
  MAL-ED BANGLADESH                               0     0
  MAL-ED BRAZIL                                   0     0
  MAL-ED INDIA                                    0     0
  MAL-ED NEPAL                                    0     0
  MAL-ED PERU                                     0     0
  MAL-ED SOUTH AFRICA                             0     0
  MAL-ED TANZANIA, UNITED REPUBLIC OF             0     0
  NIH-Birth BANGLADESH                            0     0
  NIH-Crypto BANGLADESH                         541   217
  PROBIT BELARUS                                  0     0
  PROVIDE BANGLADESH                            512   188
  ResPak PAKISTAN                                 0     0
  SAS-CompFeed INDIA                              0     0
  SAS-FoodSuppl INDIA                             0     0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF  1637   748
  VITAMIN-A INDIA                                 0     0
  ZVITAMBO ZIMBABWE                               0     0
> 
> d$nchldlt5 <- relevel(d$nchldlt5, ref="1")
> 
> table(d$parity)

    1     2     3     4     5     6     7     8     9    10    11    12    13 
24132 20607 12934 10176  2505  2335   566   348   513   123    63    32     6 
   14    15    17    19 
    5     2     1     2 
> table(paste0(d$studyid," ", d$country), d$parity)
                                             
                                                  1     2     3     4     5
  Burkina Faso Zn BURKINA FASO                 1321  1197   992  1355     0
  CMC-V-BCS-2002 INDIA                            0     0     0     0     0
  CMIN BANGLADESH                                 0     0     0     0     0
  COHORTS GUATEMALA                             317   309   280  1093     0
  COHORTS INDIA                                 827  1199  1040  1620     0
  COHORTS PHILIPPINES                           678   690   597  1093     0
  CONTENT PERU                                    0     0     0     0     0
  EE PAKISTAN                                     0     0     0     0     0
  GMS-Nepal NEPAL                               211   181   128    89    48
  Guatemala BSC GUATEMALA                         0     0     0     0     0
  iLiNS-DOSE MALAWI                               0     0     0     0     0
  iLiNS-DYAD-M MALAWI                           215   269   262   205   158
  iLiNS-Zinc BURKINA FASO                         0     0     0     0     0
  IRC INDIA                                       0     0     0     0     0
  JiVitA-3 BANGLADESH                         10327  9027  4737  2018   760
  JiVitA-4 BANGLADESH                             0     0     0     0     0
  Keneba GAMBIA                                 241   215   233   238   223
  LCNI-5 MALAWI                                   0     0     0     0     0
  MAL-ED BANGLADESH                               0     0     0     0     0
  MAL-ED BRAZIL                                   0     0     0     0     0
  MAL-ED INDIA                                    0     0     0     0     0
  MAL-ED NEPAL                                    0     0     0     0     0
  MAL-ED PERU                                     0     0     0     0     0
  MAL-ED SOUTH AFRICA                             0     0     0     0     0
  MAL-ED TANZANIA, UNITED REPUBLIC OF             0     0     0     0     0
  NIH-Birth BANGLADESH                            0     0     0     0     0
  NIH-Crypto BANGLADESH                           0     0     0     0     0
  PROBIT BELARUS                                  0     0     0     0     0
  PROVIDE BANGLADESH                            271   244   103    50    21
  ResPak PAKISTAN                                 0     0     0     0     0
  SAS-CompFeed INDIA                           2806  2213  2012  1180   696
  SAS-FoodSuppl INDIA                            21    77    92    74    54
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF   821   771   460   192    82
  VITAMIN-A INDIA                                 0     0     0     0     0
  ZVITAMBO ZIMBABWE                            6076  4215  1998   969   463
                                             
                                                  6     7     8     9    10
  Burkina Faso Zn BURKINA FASO                 1093     0     0   283     0
  CMC-V-BCS-2002 INDIA                            0     0     0     0     0
  CMIN BANGLADESH                                 0     0     0     0     0
  COHORTS GUATEMALA                               0     0     0     0     0
  COHORTS INDIA                                   0     0     0     0     0
  COHORTS PHILIPPINES                             0     0     0     0     0
  CONTENT PERU                                    0     0     0     0     0
  EE PAKISTAN                                     0     0     0     0     0
  GMS-Nepal NEPAL                                19     5     9     4     3
  Guatemala BSC GUATEMALA                         0     0     0     0     0
  iLiNS-DOSE MALAWI                               0     0     0     0     0
  iLiNS-DYAD-M MALAWI                            63    24     6     3     0
  iLiNS-Zinc BURKINA FASO                         0     0     0     0     0
  IRC INDIA                                       0     0     0     0     0
  JiVitA-3 BANGLADESH                           295   123    43    19     7
  JiVitA-4 BANGLADESH                             0     0     0     0     0
  Keneba GAMBIA                                 231   173   125   129    94
  LCNI-5 MALAWI                                   0     0     0     0     0
  MAL-ED BANGLADESH                               0     0     0     0     0
  MAL-ED BRAZIL                                   0     0     0     0     0
  MAL-ED INDIA                                    0     0     0     0     0
  MAL-ED NEPAL                                    0     0     0     0     0
  MAL-ED PERU                                     0     0     0     0     0
  MAL-ED SOUTH AFRICA                             0     0     0     0     0
  MAL-ED TANZANIA, UNITED REPUBLIC OF             0     0     0     0     0
  NIH-Birth BANGLADESH                            0     0     0     0     0
  NIH-Crypto BANGLADESH                           0     0     0     0     0
  PROBIT BELARUS                                  0     0     0     0     0
  PROVIDE BANGLADESH                              6     3     1     0     1
  ResPak PAKISTAN                                 0     0     0     0     0
  SAS-CompFeed INDIA                            329   118   121    56     7
  SAS-FoodSuppl INDIA                            58    23    11     5     1
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF    21     7     2     0     0
  VITAMIN-A INDIA                                 0     0     0     0     0
  ZVITAMBO ZIMBABWE                             220    90    30    14    10
                                             
                                                 11    12    13    14    15
  Burkina Faso Zn BURKINA FASO                    0     0     0     0     0
  CMC-V-BCS-2002 INDIA                            0     0     0     0     0
  CMIN BANGLADESH                                 0     0     0     0     0
  COHORTS GUATEMALA                               0     0     0     0     0
  COHORTS INDIA                                   0     0     0     0     0
  COHORTS PHILIPPINES                             0     0     0     0     0
  CONTENT PERU                                    0     0     0     0     0
  EE PAKISTAN                                     0     0     0     0     0
  GMS-Nepal NEPAL                                 1     0     0     0     0
  Guatemala BSC GUATEMALA                         0     0     0     0     0
  iLiNS-DOSE MALAWI                               0     0     0     0     0
  iLiNS-DYAD-M MALAWI                             0     0     0     0     0
  iLiNS-Zinc BURKINA FASO                         0     0     0     0     0
  IRC INDIA                                       0     0     0     0     0
  JiVitA-3 BANGLADESH                             5     1     0     1     0
  JiVitA-4 BANGLADESH                             0     0     0     0     0
  Keneba GAMBIA                                  54    30     6     4     2
  LCNI-5 MALAWI                                   0     0     0     0     0
  MAL-ED BANGLADESH                               0     0     0     0     0
  MAL-ED BRAZIL                                   0     0     0     0     0
  MAL-ED INDIA                                    0     0     0     0     0
  MAL-ED NEPAL                                    0     0     0     0     0
  MAL-ED PERU                                     0     0     0     0     0
  MAL-ED SOUTH AFRICA                             0     0     0     0     0
  MAL-ED TANZANIA, UNITED REPUBLIC OF             0     0     0     0     0
  NIH-Birth BANGLADESH                            0     0     0     0     0
  NIH-Crypto BANGLADESH                           0     0     0     0     0
  PROBIT BELARUS                                  0     0     0     0     0
  PROVIDE BANGLADESH                              0     0     0     0     0
  ResPak PAKISTAN                                 0     0     0     0     0
  SAS-CompFeed INDIA                              0     1     0     0     0
  SAS-FoodSuppl INDIA                             2     0     0     0     0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF     0     0     0     0     0
  VITAMIN-A INDIA                                 0     0     0     0     0
  ZVITAMBO ZIMBABWE                               1     0     0     0     0
                                             
                                                 17    19
  Burkina Faso Zn BURKINA FASO                    0     0
  CMC-V-BCS-2002 INDIA                            0     0
  CMIN BANGLADESH                                 0     0
  COHORTS GUATEMALA                               0     0
  COHORTS INDIA                                   0     0
  COHORTS PHILIPPINES                             0     0
  CONTENT PERU                                    0     0
  EE PAKISTAN                                     0     0
  GMS-Nepal NEPAL                                 0     0
  Guatemala BSC GUATEMALA                         0     0
  iLiNS-DOSE MALAWI                               0     0
  iLiNS-DYAD-M MALAWI                             0     0
  iLiNS-Zinc BURKINA FASO                         0     0
  IRC INDIA                                       0     0
  JiVitA-3 BANGLADESH                             0     0
  JiVitA-4 BANGLADESH                             0     0
  Keneba GAMBIA                                   0     2
  LCNI-5 MALAWI                                   0     0
  MAL-ED BANGLADESH                               0     0
  MAL-ED BRAZIL                                   0     0
  MAL-ED INDIA                                    0     0
  MAL-ED NEPAL                                    0     0
  MAL-ED PERU                                     0     0
  MAL-ED SOUTH AFRICA                             0     0
  MAL-ED TANZANIA, UNITED REPUBLIC OF             0     0
  NIH-Birth BANGLADESH                            0     0
  NIH-Crypto BANGLADESH                           0     0
  PROBIT BELARUS                                  0     0
  PROVIDE BANGLADESH                              0     0
  ResPak PAKISTAN                                 0     0
  SAS-CompFeed INDIA                              0     0
  SAS-FoodSuppl INDIA                             0     0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF     1     0
  VITAMIN-A INDIA                                 0     0
  ZVITAMBO ZIMBABWE                               0     0
> 
> parity<-NA
> parity[d$parity==1] <- "1"
> parity[d$parity==2] <- "2"
> parity[d$parity>2] <- "3+"
> d$parity <- as.factor(parity)
> table(d$parity)

    1     2    3+ 
24132 20607 29611 
> table(paste0(d$studyid," ", d$country), d$parity)
                                             
                                                  1     2    3+
  Burkina Faso Zn BURKINA FASO                 1321  1197  3723
  CMC-V-BCS-2002 INDIA                            0     0     0
  CMIN BANGLADESH                                 0     0     0
  COHORTS GUATEMALA                             317   309  1373
  COHORTS INDIA                                 827  1199  2660
  COHORTS PHILIPPINES                           678   690  1690
  CONTENT PERU                                    0     0     0
  EE PAKISTAN                                     0     0     0
  GMS-Nepal NEPAL                               211   181   306
  Guatemala BSC GUATEMALA                         0     0     0
  iLiNS-DOSE MALAWI                               0     0     0
  iLiNS-DYAD-M MALAWI                           215   269   721
  iLiNS-Zinc BURKINA FASO                         0     0     0
  IRC INDIA                                       0     0     0
  JiVitA-3 BANGLADESH                         10327  9027  8009
  JiVitA-4 BANGLADESH                             0     0     0
  Keneba GAMBIA                                 241   215  1544
  LCNI-5 MALAWI                                   0     0     0
  MAL-ED BANGLADESH                               0     0     0
  MAL-ED BRAZIL                                   0     0     0
  MAL-ED INDIA                                    0     0     0
  MAL-ED NEPAL                                    0     0     0
  MAL-ED PERU                                     0     0     0
  MAL-ED SOUTH AFRICA                             0     0     0
  MAL-ED TANZANIA, UNITED REPUBLIC OF             0     0     0
  NIH-Birth BANGLADESH                            0     0     0
  NIH-Crypto BANGLADESH                           0     0     0
  PROBIT BELARUS                                  0     0     0
  PROVIDE BANGLADESH                            271   244   185
  ResPak PAKISTAN                                 0     0     0
  SAS-CompFeed INDIA                           2806  2213  4520
  SAS-FoodSuppl INDIA                            21    77   320
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF   821   771   765
  VITAMIN-A INDIA                                 0     0     0
  ZVITAMBO ZIMBABWE                            6076  4215  3795
> 
> 
> 
> d$parity <- relevel(d$parity, ref="1")
> 
> 
> 
> 
> #---------------------------------------
> # Set reference levels
> #---------------------------------------
> 
> #birthweight
> # Low birth weight: < 2500
> # healthy birth weight 2500-4200
> 
> d$birthwt <- relevel(d$birthwt, ref="Normal or high birthweight")
> 
> 
> #birth length: 
> #No WHO categories:
> #Based on quantiles
> 
> d$birthlen <- relevel(d$birthlen, ref=">=50 cm")
> 
> #wealth index: 
> #wealthiest quartile - Q4 is baseline
> table(paste0(d$studyid," ", d$country), d$hhwealth_quart)
                                             
                                              Wealth Q1 Wealth Q2 Wealth Q3
  Burkina Faso Zn BURKINA FASO                        0         0         0
  CMC-V-BCS-2002 INDIA                               91        95        91
  CMIN BANGLADESH                                     0         0         0
  COHORTS GUATEMALA                                 358       377       374
  COHORTS INDIA                                       0         0         0
  COHORTS PHILIPPINES                               687       542       985
  CONTENT PERU                                       59        52        52
  EE PAKISTAN                                         0         0         0
  GMS-Nepal NEPAL                                   175       174       174
  Guatemala BSC GUATEMALA                             0         0         0
  iLiNS-DOSE MALAWI                                 470       470       468
  iLiNS-DYAD-M MALAWI                               299       300       301
  iLiNS-Zinc BURKINA FASO                             0         0         0
  IRC INDIA                                         105       102       103
  JiVitA-3 BANGLADESH                              6628      6689      6841
  JiVitA-4 BANGLADESH                              1372      1345      1361
  Keneba GAMBIA                                       0         0         0
  LCNI-5 MALAWI                                     204       199       197
  MAL-ED BANGLADESH                                  60        61        60
  MAL-ED BRAZIL                                      53        53        51
  MAL-ED INDIA                                       60        58        58
  MAL-ED NEPAL                                       59        59        59
  MAL-ED PERU                                        68        71        65
  MAL-ED SOUTH AFRICA                                64        64        64
  MAL-ED TANZANIA, UNITED REPUBLIC OF                63        62        62
  NIH-Birth BANGLADESH                                0         0         0
  NIH-Crypto BANGLADESH                               0         0         0
  PROBIT BELARUS                                      0         0         0
  PROVIDE BANGLADESH                                174       176       175
  ResPak PAKISTAN                                     0         0         0
  SAS-CompFeed INDIA                                  0         0         0
  SAS-FoodSuppl INDIA                                 0         0         0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF       719       483       589
  VITAMIN-A INDIA                                     0         0         0
  ZVITAMBO ZIMBABWE                                   0         0         0
                                             
                                              Wealth Q4
  Burkina Faso Zn BURKINA FASO                        0
  CMC-V-BCS-2002 INDIA                               96
  CMIN BANGLADESH                                     0
  COHORTS GUATEMALA                                 743
  COHORTS INDIA                                       0
  COHORTS PHILIPPINES                               843
  CONTENT PERU                                       52
  EE PAKISTAN                                         0
  GMS-Nepal NEPAL                                   175
  Guatemala BSC GUATEMALA                             0
  iLiNS-DOSE MALAWI                                 470
  iLiNS-DYAD-M MALAWI                               305
  iLiNS-Zinc BURKINA FASO                             0
  IRC INDIA                                         100
  JiVitA-3 BANGLADESH                              7178
  JiVitA-4 BANGLADESH                              1350
  Keneba GAMBIA                                       0
  LCNI-5 MALAWI                                     217
  MAL-ED BANGLADESH                                  61
  MAL-ED BRAZIL                                      53
  MAL-ED INDIA                                       59
  MAL-ED NEPAL                                       59
  MAL-ED PERU                                        68
  MAL-ED SOUTH AFRICA                                65
  MAL-ED TANZANIA, UNITED REPUBLIC OF                63
  NIH-Birth BANGLADESH                                0
  NIH-Crypto BANGLADESH                               0
  PROBIT BELARUS                                      0
  PROVIDE BANGLADESH                                175
  ResPak PAKISTAN                                     0
  SAS-CompFeed INDIA                                  0
  SAS-FoodSuppl INDIA                                 0
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF       593
  VITAMIN-A INDIA                                     0
  ZVITAMBO ZIMBABWE                                   0
> d$hhwealth_quart <- relevel(d$hhwealth_quart, ref="Wealth Q4")
> 
> # children < 5 in HH
> #not sure how this could be zero - can you double check this? 
> #baseline should be smallest number
> 
> d$nchldlt5 <- relevel(d$nchldlt5, ref="1")
> 
> #gestational age at birth
> #<37 weeks = preterm
> #37-38 weeks = early term
> #39-40 weeks = full term (baseline)
> #>=41 weeks = late/post term
> 
> d$gagebrth <- relevel(d$gagebrth, ref="Full or late term")
> 
> #maternal BMI (is this measured when pregnant or not? if pregnant, then we may need to change these categories)
> #<18.5 = underweight
> #>=18.5 and <25 = normal weight (baseline)
> #>=25 and <30 = overweight
> #>=30 = obese
> 
> d$mbmi <- relevel(d$mbmi, ref="Normal weight")
> 
> #maternal height (https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3095774/)
> #less than 145 cm
> #145-149.9 cm
> #150-154.9 cm
> #155-159.9 cm
> #160.0 cm or greater. (baseline)
> 
> d$mhtcm <- relevel(d$mhtcm, ref=">=155 cm")
> 
> #maternal weight?
> d$mwtkg <- relevel(d$mwtkg, ref=">=58 kg")
> 
> #mother's/father's education
> #lowest education level = baseline
> d$meducyrs <- relevel(factor(d$meducyrs), ref="Low")
> d$feducyrs <- relevel(factor(d$feducyrs), ref="Low")
> 
> #mother's age
> #middle = baseline
> d$mage <- relevel(d$mage, ref="[20-30)")
> 
> #father age
> #oldest = baseline
> d$fage <- relevel(d$fage, ref=">=38")
> 
> #father height
> d$fhtcm <- relevel(d$fhtcm, ref=">=167 cm")
> 
> #parental education
> d$meducyrs <- relevel(d$meducyrs, ref="High")
> d$feducyrs <- relevel(d$feducyrs, ref="High")
> 
> #number of rooms
> d$nrooms <- relevel(d$nrooms, ref="4+")
> 
> 
> 
> #Set remaining risk factors to factors
> d$brthmon <- factor(d$brthmon)
> d$month <- factor(d$month)
> d$single <- factor(d$single)
> d$vagbrth <- factor(d$vagbrth)
> d$hdlvry <- factor(d$hdlvry)
> d$hfoodsec <- factor(d$hfoodsec)
> d$enstunt <- factor(d$enstunt)
> d$sex <- factor(d$sex)
> d$meducyrs <- factor(d$meducyrs)
> 
> #Check that all risk factor variables are set as factors
> d<-as.data.frame(d)
> for(i in 1:ncol(d)){
+   cat(colnames(d)[i], ": ", class(d[,i]), "\n")
+ }
studyid :  character 
subjid :  character 
sex :  factor 
month :  factor 
wtkg :  numeric 
htcm :  numeric 
lencm :  numeric 
hcircm :  numeric 
muaccm :  numeric 
muaz :  numeric 
siteid :  integer 
ctrycd :  character 
country :  character 
region :  character 
citytown :  character 
latitude :  numeric 
longitud :  numeric 
clustid :  integer 
arm :  character 
tr :  character 
gagebrth :  factor 
dead :  integer 
agedth :  integer 
causedth :  character 
brthyr :  integer 
brthmon :  factor 
parity :  factor 
birthwt :  factor 
birthlen :  factor 
vagbrth :  factor 
hdlvry :  factor 
mage :  factor 
mhtcm :  factor 
mwtkg :  factor 
mbmi :  factor 
meducyrs :  factor 
single :  factor 
fage :  factor 
fhtcm :  factor 
feducyrs :  factor 
trth2o :  integer 
cleanck :  integer 
impfloor :  integer 
nrooms :  factor 
nhh :  factor 
nchldlt5 :  factor 
earlybf :  integer 
hfoodsec :  factor 
measurefreq :  character 
anywast06 :  numeric 
pers_wast :  numeric 
enstunt :  factor 
enwast :  numeric 
hhwealth_quart :  factor 
id :  character 
W_gagebrth :  integer 
W_birthwt :  numeric 
W_birthlen :  numeric 
W_mage :  numeric 
W_mhtcm :  numeric 
W_mwtkg :  numeric 
W_mbmi :  numeric 
W_fage :  integer 
W_fhtcm :  numeric 
W_meducyrs :  integer 
W_feducyrs :  integer 
W_nrooms :  integer 
W_nhh :  integer 
W_nchldlt5 :  numeric 
W_parity :  numeric 
> 
> 
> 
> #Tabulate missingness
> for(i in 1:ncol(d)){
+   print(colnames(d)[i])
+   print(table(is.na(d[,i])))
+   print(levels(d[,i]))
+ }
[1] "studyid"

 FALSE 
117372 
NULL
[1] "subjid"

 FALSE 
117372 
NULL
[1] "sex"

 FALSE 
117372 
[1] "Female" "Male"  
[1] "month"

 FALSE   TRUE 
103334  14038 
 [1] "1"  "2"  "3"  "4"  "5"  "6"  "7"  "8"  "9"  "10" "11" "12"
[1] "wtkg"

 FALSE   TRUE 
117163    209 
NULL
[1] "htcm"

 FALSE   TRUE 
 10351 107021 
NULL
[1] "lencm"

 FALSE   TRUE 
107020  10352 
NULL
[1] "hcircm"

FALSE  TRUE 
82168 35204 
NULL
[1] "muaccm"

FALSE  TRUE 
52771 64601 
NULL
[1] "muaz"

 FALSE   TRUE 
 16104 101268 
NULL
[1] "siteid"

 FALSE 
117372 
NULL
[1] "ctrycd"

 FALSE 
117372 
NULL
[1] "country"

 FALSE 
117372 
NULL
[1] "region"

 FALSE 
117372 
NULL
[1] "citytown"

 FALSE 
117372 
NULL
[1] "latitude"

 FALSE   TRUE 
117093    279 
NULL
[1] "longitud"

 FALSE   TRUE 
117093    279 
NULL
[1] "clustid"

FALSE  TRUE 
62510 54862 
NULL
[1] "arm"

 FALSE 
117372 
NULL
[1] "tr"

FALSE  TRUE 
97971 19401 
NULL
[1] "gagebrth"

FALSE  TRUE 
54850 62522 
[1] "Full or late term" "Preterm"           "Early term"       
[1] "dead"

FALSE  TRUE 
49919 67453 
NULL
[1] "agedth"

 FALSE   TRUE 
  2372 115000 
NULL
[1] "causedth"

 FALSE 
117372 
NULL
[1] "brthyr"

 FALSE   TRUE 
113893   3479 
NULL
[1] "brthmon"

 FALSE   TRUE 
104034  13338 
 [1] "1"  "2"  "3"  "4"  "5"  "6"  "7"  "8"  "9"  "10" "11" "12"
[1] "parity"

FALSE  TRUE 
74350 43022 
[1] "1"  "2"  "3+"
[1] "birthwt"

FALSE  TRUE 
89259 28113 
[1] "Normal or high birthweight" "Low birthweight"           
[1] "birthlen"

FALSE  TRUE 
83890 33482 
[1] ">=50 cm"    "<48 cm"     "[48-50) cm"
[1] "vagbrth"

FALSE  TRUE 
68124 49248 
[1] "0" "1"
[1] "hdlvry"

FALSE  TRUE 
24868 92504 
[1] "0" "1"
[1] "mage"

 FALSE   TRUE 
107098  10274 
[1] "[20-30)" "<20"     ">=30"   
[1] "mhtcm"

FALSE  TRUE 
88895 28477 
[1] ">=155 cm"     "<151 cm"      "[151-155) cm"
[1] "mwtkg"

FALSE  TRUE 
81094 36278 
[1] ">=58 kg"    "<52 kg"     "[52-58) kg"
[1] "mbmi"

FALSE  TRUE 
78844 38528 
[1] "Normal weight" "Underweight"  
[1] "meducyrs"

 FALSE   TRUE 
106693  10679 
[1] "High"   "Low"    "Medium"
[1] "single"

FALSE  TRUE 
54197 63175 
[1] "0" "1"
[1] "fage"

FALSE  TRUE 
34791 82581 
[1] ">=38"    "<32"     "[32-38)"
[1] "fhtcm"

FALSE  TRUE 
21484 95888 
[1] ">=167 cm"     "<162 cm"      "[162-167) cm"
[1] "feducyrs"

FALSE  TRUE 
90973 26399 
[1] "High"   "Low"    "Medium"
[1] "trth2o"

 FALSE   TRUE 
  2138 115234 
NULL
[1] "cleanck"

 FALSE   TRUE 
  8787 108585 
NULL
[1] "impfloor"

FALSE  TRUE 
37988 79384 
NULL
[1] "nrooms"

FALSE  TRUE 
49091 68281 
[1] "4+" "1"  "2"  "3" 
[1] "nhh"

 FALSE   TRUE 
  4022 113350 
[1] "3 or less" "4-5"       "6-7"       "8+"       
[1] "nchldlt5"

FALSE  TRUE 
37677 79695 
[1] "1"  "2+"
[1] "earlybf"

FALSE  TRUE 
59489 57883 
NULL
[1] "hfoodsec"

FALSE  TRUE 
28362 89010 
[1] "Food Secure"          "Mildly Food Insecure" "Food Insecure"       
[1] "measurefreq"

 FALSE 
117372 
NULL
[1] "anywast06"

 FALSE   TRUE 
 10334 107038 
NULL
[1] "pers_wast"

 FALSE   TRUE 
  9633 107739 
NULL
[1] "enstunt"

 FALSE 
117372 
[1] "0" "1"
[1] "enwast"

 FALSE   TRUE 
109122   8250 
NULL
[1] "hhwealth_quart"

FALSE  TRUE 
48055 69317 
[1] "Wealth Q4" "Wealth Q1" "Wealth Q2" "Wealth Q3"
[1] "id"

 FALSE 
117372 
NULL
[1] "W_gagebrth"

FALSE  TRUE 
54850 62522 
NULL
[1] "W_birthwt"

FALSE  TRUE 
89259 28113 
NULL
[1] "W_birthlen"

FALSE  TRUE 
83890 33482 
NULL
[1] "W_mage"

 FALSE   TRUE 
107098  10274 
NULL
[1] "W_mhtcm"

FALSE  TRUE 
88895 28477 
NULL
[1] "W_mwtkg"

FALSE  TRUE 
81094 36278 
NULL
[1] "W_mbmi"

FALSE  TRUE 
78844 38528 
NULL
[1] "W_fage"

FALSE  TRUE 
34791 82581 
NULL
[1] "W_fhtcm"

FALSE  TRUE 
21484 95888 
NULL
[1] "W_meducyrs"

 FALSE   TRUE 
106693  10679 
NULL
[1] "W_feducyrs"

FALSE  TRUE 
90973 26399 
NULL
[1] "W_nrooms"

FALSE  TRUE 
49091 68281 
NULL
[1] "W_nhh"

 FALSE   TRUE 
  4022 113350 
NULL
[1] "W_nchldlt5"

FALSE  TRUE 
37677 79695 
NULL
[1] "W_parity"

FALSE  TRUE 
74350 43022 
NULL
> 
> 
> 
> #--------------------------------------------
> # Check for sparsity across RF levels
> #--------------------------------------------
> 
> tabRF <- function(d, Avar){
+   tab <- table(paste0(d$studyid, " ",d$country), d[,Avar])
+   tab <- tab[rowSums(tab)!=0, ]
+   print(tab)
+ }
> 
> 
> 
> 
> 
> tabRF(d, "gagebrth")
                                             
                                              Full or late term Preterm
  CMC-V-BCS-2002 INDIA                                      215      52
  COHORTS GUATEMALA                                         454     134
  COHORTS INDIA                                             594     319
  COHORTS PHILIPPINES                                      1167     653
  iLiNS-DYAD-M MALAWI                                       795      96
  IRC INDIA                                                 250      42
  JiVitA-3 BANGLADESH                                     13408    5461
  Keneba GAMBIA                                             847     257
  NIH-Crypto BANGLADESH                                     168     265
  PROBIT BELARUS                                           8630     591
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF              1390     350
                                             
                                              Early term
  CMC-V-BCS-2002 INDIA                                84
  COHORTS GUATEMALA                                  237
  COHORTS INDIA                                      466
  COHORTS PHILIPPINES                               1212
  iLiNS-DYAD-M MALAWI                                314
  IRC INDIA                                           98
  JiVitA-3 BANGLADESH                               7176
  Keneba GAMBIA                                      609
  NIH-Crypto BANGLADESH                              325
  PROBIT BELARUS                                    7677
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF        514
> tabRF(d, "birthwt")
                                             
                                              Normal or high birthweight
  CMC-V-BCS-2002 INDIA                                               322
  CMIN BANGLADESH                                                     13
  COHORTS GUATEMALA                                                  859
  COHORTS INDIA                                                     5385
  COHORTS PHILIPPINES                                               2716
  CONTENT PERU                                                         2
  EE PAKISTAN                                                        245
  GMS-Nepal NEPAL                                                    466
  iLiNS-DYAD-M MALAWI                                                894
  IRC INDIA                                                          335
  JiVitA-3 BANGLADESH                                              13009
  JiVitA-4 BANGLADESH                                               3329
  Keneba GAMBIA                                                     1316
  MAL-ED BANGLADESH                                                  205
  MAL-ED BRAZIL                                                      221
  MAL-ED INDIA                                                       205
  MAL-ED NEPAL                                                       214
  MAL-ED PERU                                                        282
  MAL-ED SOUTH AFRICA                                                290
  MAL-ED TANZANIA, UNITED REPUBLIC OF                                187
  NIH-Birth BANGLADESH                                               412
  NIH-Crypto BANGLADESH                                              581
  PROBIT BELARUS                                                   16898
  PROVIDE BANGLADESH                                                 532
  ResPak PAKISTAN                                                     34
  SAS-CompFeed INDIA                                                7159
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF                       2289
  ZVITAMBO ZIMBABWE                                                12107
                                             
                                              Low birthweight
  CMC-V-BCS-2002 INDIA                                     43
  CMIN BANGLADESH                                          13
  COHORTS GUATEMALA                                        85
  COHORTS INDIA                                          1395
  COHORTS PHILIPPINES                                     295
  CONTENT PERU                                              0
  EE PAKISTAN                                             134
  GMS-Nepal NEPAL                                         231
  iLiNS-DYAD-M MALAWI                                     136
  IRC INDIA                                                69
  JiVitA-3 BANGLADESH                                    9890
  JiVitA-4 BANGLADESH                                    1179
  Keneba GAMBIA                                           222
  MAL-ED BANGLADESH                                        57
  MAL-ED BRAZIL                                            12
  MAL-ED INDIA                                             36
  MAL-ED NEPAL                                             19
  MAL-ED PERU                                              17
  MAL-ED SOUTH AFRICA                                      22
  MAL-ED TANZANIA, UNITED REPUBLIC OF                      10
  NIH-Birth BANGLADESH                                    196
  NIH-Crypto BANGLADESH                                   177
  PROBIT BELARUS                                            0
  PROVIDE BANGLADESH                                      168
  ResPak PAKISTAN                                           8
  SAS-CompFeed INDIA                                     2322
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF              82
  ZVITAMBO ZIMBABWE                                      1934
> tabRF(d, "birthlen")
                                     
                                      >=50 cm <48 cm [48-50) cm
  CMC-V-BCS-2002 INDIA                     16     50         40
  CMIN BANGLADESH                           2     19          5
  COHORTS GUATEMALA                       437    163        252
  COHORTS INDIA                          1426   2779       2440
  COHORTS PHILIPPINES                    1129    762       1159
  CONTENT PERU                              1      1          0
  EE PAKISTAN                              22    174         46
  GMS-Nepal NEPAL                         104    385        208
  iLiNS-DYAD-M MALAWI                       5     10          8
  IRC INDIA                               142    111        138
  JiVitA-3 BANGLADESH                    1229  16235       5091
  JiVitA-4 BANGLADESH                    1232   2174       1077
  Keneba GAMBIA                           764    293        495
  MAL-ED BANGLADESH                        35    117         79
  MAL-ED BRAZIL                            23     18         24
  MAL-ED INDIA                              9     22         16
  MAL-ED NEPAL                              7     12          8
  MAL-ED PERU                              41     92        100
  MAL-ED SOUTH AFRICA                      35     36         52
  MAL-ED TANZANIA, UNITED REPUBLIC OF      20     44         61
  NIH-Birth BANGLADESH                    124    253        231
  NIH-Crypto BANGLADESH                   168    292        298
  PROBIT BELARUS                        15312    191       1395
  PROVIDE BANGLADESH                      169    248        283
  ResPak PAKISTAN                          10     19         13
  SAS-CompFeed INDIA                     1406   5050       3004
  ZVITAMBO ZIMBABWE                      4126   4482       5341
> tabRF(d, "parity") 
                                             
                                                  1     2    3+
  Burkina Faso Zn BURKINA FASO                 1321  1197  3723
  COHORTS GUATEMALA                             317   309  1373
  COHORTS INDIA                                 827  1199  2660
  COHORTS PHILIPPINES                           678   690  1690
  GMS-Nepal NEPAL                               211   181   306
  iLiNS-DYAD-M MALAWI                           215   269   721
  JiVitA-3 BANGLADESH                         10327  9027  8009
  Keneba GAMBIA                                 241   215  1544
  PROVIDE BANGLADESH                            271   244   185
  SAS-CompFeed INDIA                           2806  2213  4520
  SAS-FoodSuppl INDIA                            21    77   320
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF   821   771   765
  ZVITAMBO ZIMBABWE                            6076  4215  3795
> tabRF(d, "mage")
                                             
                                              [20-30)   <20  >=30
  Burkina Faso Zn BURKINA FASO                   3066   848  2327
  CMC-V-BCS-2002 INDIA                            296    34    43
  COHORTS GUATEMALA                               984   300   717
  COHORTS INDIA                                  3646   436  1292
  COHORTS PHILIPPINES                            1827   378   853
  EE PAKISTAN                                     162     1   214
  GMS-Nepal NEPAL                                 447   149   102
  Guatemala BSC GUATEMALA                         175    47    59
  iLiNS-DOSE MALAWI                              1079   301   469
  iLiNS-DYAD-M MALAWI                             671   283   251
  iLiNS-Zinc BURKINA FASO                        1743   403  1033
  IRC INDIA                                       344    37    29
  JiVitA-3 BANGLADESH                           12751 12257  2344
  Keneba GAMBIA                                  1455   399  1042
  LCNI-5 MALAWI                                   364   108   198
  MAL-ED BANGLADESH                               182    37    46
  MAL-ED BRAZIL                                   139    43    51
  MAL-ED INDIA                                    194    34    21
  MAL-ED NEPAL                                    189     5    46
  MAL-ED PERU                                     153    83    67
  MAL-ED SOUTH AFRICA                             161    48   105
  MAL-ED TANZANIA, UNITED REPUBLIC OF             140    16   106
  NIH-Birth BANGLADESH                            422    73   132
  NIH-Crypto BANGLADESH                           494   136   128
  PROBIT BELARUS                                12130  1745  3023
  PROVIDE BANGLADESH                              493    85   122
  SAS-CompFeed INDIA                             7274  1227  1038
  SAS-FoodSuppl INDIA                             290    36    92
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF    1571   167   638
  VITAMIN-A INDIA                                3146   247   512
  ZVITAMBO ZIMBABWE                              9447  2243  2357
> tabRF(d, "mhtcm") 
                                             
                                              >=155 cm <151 cm [151-155) cm
  Burkina Faso Zn BURKINA FASO                    5033     327          800
  COHORTS GUATEMALA                                221    1108          353
  COHORTS INDIA                                    581     829          516
  COHORTS PHILIPPINES                              632    1549          877
  Guatemala BSC GUATEMALA                           36     143           56
  iLiNS-DOSE MALAWI                               1060     398          470
  iLiNS-DYAD-M MALAWI                              670     203          326
  iLiNS-Zinc BURKINA FASO                         2900      91          226
  JiVitA-3 BANGLADESH                             4166   16190         6882
  Keneba GAMBIA                                   2035      94          328
  LCNI-5 MALAWI                                    514     131          192
  MAL-ED BANGLADESH                                 25     163           66
  MAL-ED BRAZIL                                    130      53           39
  MAL-ED INDIA                                      55     115           72
  MAL-ED NEPAL                                      41     133           64
  MAL-ED PERU                                       60     169           61
  MAL-ED SOUTH AFRICA                              204      33           33
  MAL-ED TANZANIA, UNITED REPUBLIC OF              153      51           52
  NIH-Birth BANGLADESH                             117     366          146
  NIH-Crypto BANGLADESH                            140     435          180
  PROBIT BELARUS                                 13211     125          398
  PROVIDE BANGLADESH                               138     373          158
  SAS-CompFeed INDIA                              3683    3005         2091
  SAS-FoodSuppl INDIA                               78     220          111
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF     1490     358          511
  ZVITAMBO ZIMBABWE                               7839     574         1439
> tabRF(d, "mwtkg") 
                                             
                                              >=58 kg <52 kg [52-58) kg
  Burkina Faso Zn BURKINA FASO                   1673   2344       1925
  iLiNS-DOSE MALAWI                               419    938        567
  iLiNS-DYAD-M MALAWI                             288    543        369
  iLiNS-Zinc BURKINA FASO                         937   1201       1079
  JiVitA-3 BANGLADESH                             674  24878       1780
  LCNI-5 MALAWI                                   114    504        220
  MAL-ED BANGLADESH                                48    162         44
  MAL-ED BRAZIL                                   143     42         36
  MAL-ED INDIA                                     42    150         50
  MAL-ED NEPAL                                     80     76         82
  MAL-ED PERU                                     104    115         71
  MAL-ED SOUTH AFRICA                             194     30         46
  MAL-ED TANZANIA, UNITED REPUBLIC OF              98     99         59
  NIH-Birth BANGLADESH                             82    453         94
  NIH-Crypto BANGLADESH                           192    406        157
  PROBIT BELARUS                                10279   1131       2362
  PROVIDE BANGLADESH                              120    432        117
  SAS-CompFeed INDIA                              723   7248       1518
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF    1476    393        483
  ZVITAMBO ZIMBABWE                              5843   2408       2953
> tabRF(d, "mbmi") 
                                             
                                              Normal weight Underweight
  Burkina Faso Zn BURKINA FASO                         5340         602
  iLiNS-DOSE MALAWI                                    1785         136
  iLiNS-DYAD-M MALAWI                                  1130          65
  iLiNS-Zinc BURKINA FASO                              2763         454
  JiVitA-3 BANGLADESH                                 16809       10428
  LCNI-5 MALAWI                                         692         145
  MAL-ED BANGLADESH                                     222          32
  MAL-ED BRAZIL                                         211          10
  MAL-ED INDIA                                          193          49
  MAL-ED NEPAL                                          238           0
  MAL-ED PERU                                           285           5
  MAL-ED SOUTH AFRICA                                   262           8
  MAL-ED TANZANIA, UNITED REPUBLIC OF                   242          14
  NIH-Birth BANGLADESH                                  523         106
  NIH-Crypto BANGLADESH                                 687          68
  PROBIT BELARUS                                      13205         523
  PROVIDE BANGLADESH                                    542         127
  SAS-CompFeed INDIA                                   6435        2344
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF          2307          38
  ZVITAMBO ZIMBABWE                                    9302         517
> tabRF(d, "fage")
                                     
                                       >=38   <32 [32-38)
  COHORTS GUATEMALA                     545   904     451
  COHORTS PHILIPPINES                   330  2083     538
  iLiNS-DOSE MALAWI                     384   987     341
  iLiNS-DYAD-M MALAWI                   232   682     249
  LCNI-5 MALAWI                          26    56      24
  MAL-ED BANGLADESH                      69    30      52
  MAL-ED BRAZIL                          30    18      31
  MAL-ED INDIA                           36    53      72
  MAL-ED NEPAL                           17    15      47
  MAL-ED PERU                            27    29      29
  MAL-ED SOUTH AFRICA                    65     9      16
  MAL-ED TANZANIA, UNITED REPUBLIC OF    48    15      37
  PROBIT BELARUS                        744 13059    2475
  SAS-CompFeed INDIA                    309  8013    1196
  SAS-FoodSuppl INDIA                    44   289      85
> tabRF(d, "fhtcm")
                     
                      >=167 cm <162 cm [162-167) cm
  COHORTS GUATEMALA        117     506          226
  Keneba GAMBIA           1258     133          557
  PROBIT BELARUS         11744     168          625
  SAS-CompFeed INDIA      2657    1391         1703
  SAS-FoodSuppl INDIA      106     163          130
> tabRF(d, "feducyrs")
                                             
                                               High   Low Medium
  COHORTS GUATEMALA                             319   860    625
  COHORTS INDIA                                 569   475    414
  COHORTS PHILIPPINES                          1031   828   1021
  GMS-Nepal NEPAL                               173   296    227
  iLiNS-DOSE MALAWI                             698   584    525
  iLiNS-DYAD-M MALAWI                           361   433    411
  JiVitA-3 BANGLADESH                          6525 10854   8981
  JiVitA-4 BANGLADESH                          1247  1955   2076
  LCNI-5 MALAWI                                 251   291    271
  MAL-ED BANGLADESH                              54    40     55
  MAL-ED INDIA                                   44    59     44
  MAL-ED NEPAL                                   42    28     28
  MAL-ED PERU                                   120    69     61
  MAL-ED SOUTH AFRICA                            43    37     30
  MAL-ED TANZANIA, UNITED REPUBLIC OF           130    61     21
  NIH-Crypto BANGLADESH                         296   242    220
  PROBIT BELARUS                               2708  6418   7189
  PROVIDE BANGLADESH                            232   238    230
  SAS-CompFeed INDIA                           2492  3967   3059
  SAS-FoodSuppl INDIA                           110   147    161
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF   449  1270    664
  VITAMIN-A INDIA                              1666  1162   1079
  ZVITAMBO ZIMBABWE                            1002  2316  10389
> tabRF(d, "nrooms")
                                     
                                         4+     1     2     3
  CMC-V-BCS-2002 INDIA                   14   202   106    51
  COHORTS INDIA                         106  3563  1567   199
  CONTENT PERU                           78    44    54    39
  GMS-Nepal NEPAL                       323    49   145   181
  iLiNS-DOSE MALAWI                     265   340   701   446
  iLiNS-DYAD-M MALAWI                    40   136   141    65
  IRC INDIA                              17   185   170    36
  JiVitA-3 BANGLADESH                  1140 16201  7360  2629
  JiVitA-4 BANGLADESH                   286  3193  1387   562
  MAL-ED BANGLADESH                      12   152    50    28
  MAL-ED BRAZIL                         127     4    20    59
  MAL-ED INDIA                           25    84    78    48
  MAL-ED NEPAL                          131    52    31    22
  MAL-ED PERU                           139    19    52    62
  MAL-ED SOUTH AFRICA                   196    14    22    25
  MAL-ED TANZANIA, UNITED REPUBLIC OF   108    13    63    66
  NIH-Crypto BANGLADESH                  95   368   191   104
  PROVIDE BANGLADESH                     23   507   108    62
  VITAMIN-A INDIA                       244  2468   908   290
> tabRF(d, "nhh")
                       
                        3 or less 4-5 6-7  8+
  iLiNS-DYAD-M MALAWI         107  88  62  33
  IRC INDIA                    58 158 107  87
  LCNI-5 MALAWI               225 340 182  70
  NIH-Birth BANGLADESH        117 264 142 106
  NIH-Crypto BANGLADESH       114 342 178 124
  PROVIDE BANGLADESH          140 322 151  87
  SAS-FoodSuppl INDIA          38 183 127  70
> tabRF(d, "nchldlt5")
                                             
                                                  1    2+
  iLiNS-DOSE MALAWI                             845   966
  iLiNS-DYAD-M MALAWI                            63   216
  iLiNS-Zinc BURKINA FASO                      1073  2116
  IRC INDIA                                      89   321
  JiVitA-3 BANGLADESH                         17511  9822
  LCNI-5 MALAWI                                 391   421
  NIH-Crypto BANGLADESH                         541   217
  PROVIDE BANGLADESH                            512   188
  TanzaniaChild2 TANZANIA, UNITED REPUBLIC OF  1637   748
> 
> 
> 
> 
> #--------------------------------------------
> # Save dataset
> #--------------------------------------------
> 
> 
> 
> saveRDS(d, temp_clean_covariates_path)
> 
> 
> 
> proc.time()
   user  system elapsed 
139.509   8.279 148.393 
